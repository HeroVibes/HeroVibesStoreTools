<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>QR Code Generator - HeroVibes</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    /* ========================================
       RESET & BASE STYLES
    ======================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* DESIGN SYSTEM COLORS */
      --primary-bg: #191919;
      --secondary-bg: #1F1F1F;
      --hover-color: #323232;
      --outline-color: #323232;
      --accent-color: #87A9FF;
      --text-primary: #D4D4D4;
      --text-secondary: #8C8C8C;
      
      /* SPACING */
      --padding-v: 24px;
      --padding-h: 16px;
      --border-radius: 8px;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      background: var(--primary-bg);
      font-family: sans-serif;
      color: var(--text-primary);
      padding: 40px 16px;
    }

    /* ========================================
       VERSION NUMBER DISPLAY
    ======================================== */
    .version-badge {
      position: fixed;
      bottom: 12px;
      left: 12px;
      padding: 4px 8px;
      background: var(--secondary-bg);
      border: 1px solid var(--outline-color);
      border-radius: 4px;
      font-size: 10px;
      color: var(--text-secondary);
      z-index: 50;
      opacity: 0.6;
      transition: opacity 0.2s ease;
    }

    .version-badge:hover {
      opacity: 1;
    }

    @media screen and (max-width: 767px) {
      .version-badge {
        bottom: 90px;
      }
    }

    /* ========================================
       PAGE WRAPPER
    ======================================== */
    .page-wrapper {
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
    }

    /* ========================================
       MAIN LAYOUT - TWO COLUMNS ON DESKTOP
    ======================================== */
    .tool-layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
      align-items: start;
    }

    /* Desktop: Two columns side by side */
    @media screen and (min-width: 768px) {
      .tool-layout {
        grid-template-columns: 1fr 1fr;
      }
    }

    /* ========================================
       LEFT COLUMN - TOOL CONTROLS
    ======================================== */
    .tool-controls {
      background: var(--secondary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      padding: var(--padding-v) var(--padding-h);
    }

    /* ========================================
       RIGHT COLUMN - QR PREVIEW (STICKY ON DESKTOP)
    ======================================== */
    .qr-preview-column {
      background: var(--secondary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      padding: var(--padding-v) var(--padding-h);
    }

    @media screen and (min-width: 768px) {
      .qr-preview-column {
        position: sticky;
        top: 40px;
      }
    }

    /* ========================================
       FLOATING QR BUTTON (MOBILE ONLY)
    ======================================== */
    .floating-qr-btn {
      display: none;
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      background: var(--accent-color);
      border: none;
      border-radius: 50%;
      color: var(--primary-bg);
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(135, 169, 255, 0.4);
      z-index: 100;
      transition: all 0.3s ease;
      pointer-events: auto;
    }

    .floating-qr-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(135, 169, 255, 0.6);
    }

    .floating-qr-btn:active {
      transform: scale(0.95);
    }

    @media screen and (max-width: 767px) {
      .floating-qr-btn {
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }

    /* ========================================
       QUICK TEMPLATES SECTION
    ======================================== */
    .templates-section {
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
      display: block;
    }

    .template-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
    }

    .template-btn {
      padding: 10px 12px;
      background: var(--primary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      color: var(--text-secondary);
      font-size: 12px;
      font-family: sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
    }

    .template-btn:hover {
      background: var(--hover-color);
      border-color: var(--accent-color);
      color: var(--text-primary);
    }

    .template-btn.active {
      background: var(--hover-color);
      border-color: var(--accent-color);
      color: var(--accent-color);
    }

    /* ========================================
       TEMPLATE MODAL
    ======================================== */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      pointer-events: auto;
    }

    .modal-overlay.active {
      display: flex;
      pointer-events: auto;
    }

    .modal-overlay:not(.active) {
      pointer-events: none;
    }

    .modal-content {
      background: var(--secondary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      padding: 24px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      pointer-events: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .modal-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background: var(--hover-color);
      color: var(--text-primary);
    }

    .modal-body {
      margin-bottom: 16px;
    }

    .modal-input-group {
      margin-bottom: 12px;
    }

    .modal-label {
      font-size: 12px;
      color: var(--text-secondary);
      display: block;
      margin-bottom: 6px;
    }

    .modal-input {
      width: 100%;
      padding: 10px 12px;
      background: var(--primary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      color: var(--text-primary);
      font-size: 14px;
      font-family: sans-serif;
    }

    .modal-input:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    .modal-help {
      font-size: 11px;
      color: var(--text-secondary);
      margin-top: 4px;
      line-height: 1.4;
    }

    .modal-btn {
      width: 100%;
      padding: 12px;
      background: var(--primary-bg);
      border: 1px solid var(--accent-color);
      border-radius: var(--border-radius);
      color: var(--accent-color);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .modal-btn:hover {
      background: var(--hover-color);
    }

    /* Phone input with area code */
    .phone-input-wrapper {
      display: flex;
      gap: 8px;
    }

    .area-code-input {
      width: 80px;
      padding: 10px 12px;
      background: var(--primary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      color: var(--text-primary);
      font-size: 14px;
      font-family: sans-serif;
    }

    .area-code-input:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    /* ========================================
       QR USER INPUT SECTION
    ======================================== */
    .input-section {
      margin-bottom: 24px;
    }

    .input-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      display: block;
      margin-bottom: 8px;
    }

    .qr-input {
      width: 100%;
      padding: 12px 14px;
      background: var(--primary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      color: var(--text-primary);
      font-size: 14px;
      font-family: sans-serif;
      transition: border-color 0.2s ease, background 0.2s ease;
    }

    .qr-input:focus {
      outline: none;
      border-color: var(--accent-color);
      background: var(--hover-color);
    }

    .qr-input::placeholder {
      color: var(--text-secondary);
    }

    /* ========================================
       LOGO UPLOAD SECTION
    ======================================== */
    .logo-section {
      margin-bottom: 24px;
    }

    .logo-upload-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-upload-btn {
      flex: 1;
      padding: 10px 14px;
      background: var(--primary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s ease;
    }

    .logo-upload-btn:hover {
      background: var(--hover-color);
      border-color: var(--accent-color);
      color: var(--text-primary);
    }

    .logo-preview {
      width: 50px;
      height: 50px;
      background: var(--primary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
    }

    .logo-preview img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .logo-preview-empty {
      color: var(--text-secondary);
      font-size: 10px;
      text-align: center;
    }

    .logo-remove-btn {
      padding: 10px;
      background: var(--primary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .logo-remove-btn:hover {
      background: var(--hover-color);
      color: var(--text-primary);
    }

    #logoInput {
      display: none;
    }

    /* ========================================
       COLOR OPTIONS SECTION
    ======================================== */
    .options-section {
      margin-bottom: 20px;
      padding: 16px;
      background: var(--primary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
    }

    .option-group {
      margin-bottom: 16px;
    }

    .option-group:last-child {
      margin-bottom: 0;
    }

    .option-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 10px;
      display: block;
    }

    .radio-wrapper {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
    }

    .radio-label {
      display: flex;
      align-items: center;
      font-size: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .radio-label:hover {
      color: var(--text-primary);
    }

    .radio-label input[type="radio"] {
      margin-right: 6px;
      cursor: pointer;
      accent-color: var(--accent-color);
    }

    /* Color picker wrapper */
    .color-picker-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: 6px;
    }

    .color-picker-input {
      width: 40px;
      height: 32px;
      padding: 2px;
      background: var(--secondary-bg);
      border: 1px solid var(--outline-color);
      border-radius: 4px;
      cursor: pointer;
      transition: border-color 0.2s ease;
    }

    .color-picker-input:hover {
      border-color: var(--accent-color);
    }

    .custom-color-input {
      padding: 6px 10px;
      background: var(--secondary-bg);
      border: 1px solid var(--outline-color);
      border-radius: 4px;
      color: var(--text-primary);
      font-size: 12px;
      width: 90px;
      transition: border-color 0.2s ease;
    }

    .custom-color-input:focus {
      outline: none;
      border-color: var(--accent-color);
    }

    /* Gradient color inputs */
    .gradient-inputs {
      display: none;
      margin-top: 10px;
      gap: 8px;
    }

    .gradient-inputs.active {
      display: flex;
    }

    .gradient-input-wrapper {
      flex: 1;
    }

    .gradient-input-label {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 4px;
      display: block;
    }

    .gradient-color-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* ========================================
       QR DISPLAY AREA
    ======================================== */
    .qr-preview-wrapper {
      background: var(--primary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      padding: 24px;
      text-align: center;
      margin-bottom: 16px;
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .qr-preview-wrapper.transparent-bg {
      background-image: 
        linear-gradient(45deg, #2a2a2a 25%, transparent 25%),
        linear-gradient(-45deg, #2a2a2a 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #2a2a2a 75%),
        linear-gradient(-45deg, transparent 75%, #2a2a2a 75%);
      background-size: 16px 16px;
      background-position: 0 0, 0 8px, 8px -8px, -8px 0px;
      background-color: var(--primary-bg);
    }

    .qr-image-container {
      display: inline-block;
      max-width: 100%;
      position: relative;
      width: 100%;
    }

    .qr-image {
      display: block;
      width: 100%;
      max-width: 400px;
      height: auto;
      border-radius: 4px;
      margin: 0 auto;
      opacity: 1;
      transition: opacity 0.3s ease;
    }

    .qr-image.empty {
      opacity: 0;
      height: 0;
    }

    .qr-placeholder {
      color: var(--text-secondary);
      font-size: 14px;
      text-align: center;
      display: none;
    }

    .qr-image.empty ~ .qr-placeholder {
      display: block;
    }

    /* ========================================
       SHIMMER BUTTON
    ======================================== */
    .btn-download {
      position: relative;
      width: 100%;
      padding: 12px 16px;
      border-radius: var(--border-radius);
      background: var(--secondary-bg);
      color: var(--text-primary);
      border: 1px solid var(--outline-color);
      cursor: pointer;
      overflow: hidden;
      font-size: 14px;
      font-weight: 600;
      font-family: sans-serif;
      transition: background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease;
    }

    .btn-download:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-download:not(:disabled):hover {
      background: var(--hover-color);
      border-color: var(--accent-color);
    }

    .btn-download::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 75%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(135, 169, 255, 0.3), transparent);
      transform: skewX(-25deg);
      transition: left 0.7s ease-in-out;
    }

    .btn-download:not(:disabled):hover::before {
      left: 125%;
    }

    .btn-download:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(135, 169, 255, 0.3);
    }

    .btn-download:not(:disabled):active {
      transform: scale(0.98);
    }

    /* ========================================
       HISTORY SECTION
    ======================================== */
    .history-container {
      background: var(--secondary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      padding: var(--padding-v) var(--padding-h);
      max-width: 1200px;
      width: 100%;
      margin: 24px auto 0;
      display: none;
    }

    .history-container.active {
      display: block;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .history-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .history-clear-btn {
      padding: 6px 12px;
      background: var(--primary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      color: var(--text-secondary);
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .history-clear-btn:hover {
      background: var(--hover-color);
      border-color: var(--accent-color);
      color: var(--text-primary);
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .history-item {
      background: var(--primary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.3s ease;
      animation: slideIn 0.4s ease-out;
    }

    .history-item:hover {
      background: var(--hover-color);
    }

    .history-item.removing {
      animation: slideOut 0.3s ease-out forwards;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideOut {
      from {
        opacity: 1;
        transform: translateX(0);
        max-height: 100px;
        margin-bottom: 8px;
      }
      to {
        opacity: 0;
        transform: translateX(20px);
        max-height: 0;
        margin-bottom: 0;
        padding-top: 0;
        padding-bottom: 0;
      }
    }

    .history-thumbnail {
      width: 50px;
      height: 50px;
      flex-shrink: 0;
      border-radius: 4px;
      overflow: hidden;
      background: var(--secondary-bg);
    }

    .history-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .history-info {
      flex: 1;
      min-width: 0;
    }

    .history-url {
      font-size: 12px;
      color: var(--text-primary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-bottom: 4px;
    }

    .history-date {
      font-size: 10px;
      color: var(--text-secondary);
    }

    .history-actions {
      display: flex;
      gap: 6px;
      flex-shrink: 0;
    }

    .history-action-btn {
      padding: 6px 10px;
      background: var(--secondary-bg);
      border: 1px solid var(--outline-color);
      border-radius: var(--border-radius);
      color: var(--text-secondary);
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .history-action-btn:hover {
      background: var(--hover-color);
      border-color: var(--accent-color);
      color: var(--accent-color);
    }

    .history-empty {
      text-align: center;
      padding: 24px;
      color: var(--text-secondary);
      font-size: 12px;
    }

    /* ========================================
       MOBILE OPTIMIZATION
    ======================================== */
    @media screen and (max-width: 767px) {
      body {
        padding: 20px 12px;
        padding-bottom: 100px;
      }

      .tool-controls,
      .qr-preview-column,
      .history-container {
        padding: 20px 14px;
      }

      .template-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .radio-wrapper {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .custom-color-input {
        width: 100px;
      }

      .logo-upload-wrapper {
        flex-wrap: wrap;
      }

      .history-item {
        flex-wrap: wrap;
      }

      .history-actions {
        width: 100%;
        justify-content: flex-end;
      }

      .qr-input, .modal-input {
        font-size: 16px;
      }
    }

    @media screen and (max-width: 400px) {
      .tool-controls,
      .qr-preview-column,
      .history-container {
        padding: 16px 12px;
      }

      .options-section {
        padding: 12px;
      }
    }
  </style>
</head>
<body>
  
  <!-- VERSION BADGE -->
  <div class="version-badge" title="QR Code Generator Version">v1.0.6</div>

  <div class="page-wrapper">
    
    <!-- ========================================
         MAIN TOOL LAYOUT - TWO COLUMNS
    ======================================== -->
    <div class="tool-layout">
      
      <!-- LEFT COLUMN - TOOL CONTROLS -->
      <div class="tool-controls">
        
        <!-- QUICK TEMPLATES -->
        <div class="templates-section">
          <span class="section-title">Quick Templates</span>
          <div class="template-grid">
            <button class="template-btn active" data-template="url">URL/Link</button>
            <button class="template-btn" data-template="wifi">WiFi</button>
            <button class="template-btn" data-template="vcard">vCard</button>
            <button class="template-btn" data-template="email">Email</button>
            <button class="template-btn" data-template="sms">SMS</button>
            <button class="template-btn" data-template="phone">Phone</button>
          </div>
        </div>

        <!-- QR USER INPUT -->
        <div class="input-section">
          <label for="qrInput" class="input-label">Enter URL or Text</label>
          <input 
            type="text" 
            id="qrInput" 
            class="qr-input"
            placeholder="https://www.herovibes.store" 
            autocomplete="off"
            spellcheck="false"
          />
        </div>

        <!-- LOGO UPLOAD -->
        <div class="logo-section">
          <span class="input-label">Add Logo (Optional)</span>
          <div class="logo-upload-wrapper">
            <label for="logoInput" class="logo-upload-btn">
              Choose Logo Image
            </label>
            <input type="file" id="logoInput" accept="image/*" />
            <div class="logo-preview" id="logoPreview">
              <span class="logo-preview-empty">No logo</span>
            </div>
            <button class="logo-remove-btn" id="logoRemoveBtn" style="display: none;">✕</button>
          </div>
        </div>

        <!-- COLOR OPTIONS -->
        <div class="options-section">
          
          <!-- QR CODE COLOR -->
          <div class="option-group">
            <span class="option-title">QR Code Color</span>
            <div class="radio-wrapper">
              <label class="radio-label">
                <input type="radio" name="colorOption" value="#000000" checked />
                Black
              </label>
              <label class="radio-label">
                <input type="radio" name="colorOption" value="#ffffff" />
                White
              </label>
              <label class="radio-label">
                <input type="radio" name="colorOption" value="gradient" />
                Gradient
              </label>
              <label class="radio-label">
                <input type="radio" name="colorOption" value="custom" />
                Custom
                <div class="color-picker-wrapper">
                  <input 
                    type="color" 
                    id="colorPicker" 
                    class="color-picker-input"
                    value="#87A9FF"
                  />
                  <input 
                    type="text" 
                    id="customColor" 
                    class="custom-color-input"
                    value="#87A9FF" 
                    maxlength="7"
                    placeholder="#87A9FF"
                  />
                </div>
              </label>
            </div>
            <div class="gradient-inputs" id="gradientInputs">
              <div class="gradient-input-wrapper">
                <label class="gradient-input-label">Start Color</label>
                <div class="gradient-color-controls">
                  <input 
                    type="color" 
                    id="gradientPicker1" 
                    class="color-picker-input"
                    value="#87A9FF"
                  />
                  <input 
                    type="text" 
                    id="gradientColor1" 
                    class="custom-color-input"
                    value="#87A9FF" 
                    maxlength="7"
                    style="width: 100%; margin-left: 0;"
                  />
                </div>
              </div>
              <div class="gradient-input-wrapper">
                <label class="gradient-input-label">End Color</label>
                <div class="gradient-color-controls">
                  <input 
                    type="color" 
                    id="gradientPicker2" 
                    class="color-picker-input"
                    value="#FF87D4"
                  />
                  <input 
                    type="text" 
                    id="gradientColor2" 
                    class="custom-color-input"
                    value="#FF87D4" 
                    maxlength="7"
                    style="width: 100%; margin-left: 0;"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- BACKGROUND COLOR -->
          <div class="option-group">
            <span class="option-title">Background Color</span>
            <div class="radio-wrapper">
              <label class="radio-label">
                <input type="radio" name="bgToggle" value="transparent" checked />
                Transparent
              </label>
              <label class="radio-label">
                <input type="radio" name="bgToggle" value="#000000" />
                Black
              </label>
              <label class="radio-label">
                <input type="radio" name="bgToggle" value="#ffffff" />
                White
              </label>
              <label class="radio-label">
                <input type="radio" name="bgToggle" value="custom" />
                Custom
                <div class="color-picker-wrapper">
                  <input 
                    type="color" 
                    id="bgColorPicker" 
                    class="color-picker-input"
                    value="#ffffff"
                  />
                  <input 
                    type="text" 
                    id="customBgColor" 
                    class="custom-color-input"
                    value="#ffffff" 
                    maxlength="7"
                    placeholder="#ffffff"
                  />
                </div>
              </label>
            </div>
          </div>

        </div>

      </div>

      <!-- RIGHT COLUMN - QR PREVIEW (STICKY ON DESKTOP) -->
      <div class="qr-preview-column" id="qrPreviewColumn">
        
        <div class="qr-preview-wrapper" id="previewWrapper">
          <div class="qr-image-container">
            <canvas id="qrCanvas" style="display: none;"></canvas>
            <img id="qrImage" class="qr-image empty" src="" alt="QR Code Preview" />
            <div class="qr-placeholder">Enter text or URL to generate QR code</div>
          </div>
        </div>
        
        <!-- DOWNLOAD BUTTON -->
        <button type="button" class="btn-download" id="downloadButton" disabled>
          Download QR Code
        </button>
      </div>

    </div>

    <!-- ========================================
         HISTORY SECTION (BELOW BOTH COLUMNS)
    ======================================== -->
    <div class="history-container" id="historyContainer">
      <div class="history-header">
        <span class="history-title">Recent Downloads</span>
        <button class="history-clear-btn" id="historyClearBtn">Clear All</button>
      </div>
      <div class="history-list" id="historyList">
        <div class="history-empty">No QR codes downloaded yet</div>
      </div>
    </div>

  </div>

  <!-- FLOATING QR BUTTON (MOBILE ONLY) -->
  <button class="floating-qr-btn" id="floatingQrBtn" title="View QR Code">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <rect x="3" y="3" width="7" height="7"/>
      <rect x="14" y="3" width="7" height="7"/>
      <rect x="3" y="14" width="7" height="7"/>
      <rect x="14" y="14" width="7" height="7"/>
    </svg>
  </button>

  <!-- TEMPLATE MODALS (WiFi, vCard, Email, SMS, Phone) - KEEPING SAME AS BEFORE -->
  <div class="modal-overlay" id="wifiModal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title">WiFi QR Code</span>
        <button class="modal-close" onclick="closeModal('wifiModal')">×</button>
      </div>
      <div class="modal-body">
        <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 16px; line-height: 1.5;">
          Create a QR code that automatically connects devices to your WiFi network. Users just scan and connect—no manual password entry needed!
        </p>
        <div class="modal-input-group">
          <label class="modal-label">Network Name (SSID)</label>
          <input type="text" id="wifiSSID" class="modal-input" placeholder="MyNetwork" />
        </div>
        <div class="modal-input-group">
          <label class="modal-label">Password</label>
          <input type="text" id="wifiPassword" class="modal-input" placeholder="MyPassword123" />
        </div>
        <div class="modal-input-group">
          <label class="modal-label">Security Type</label>
          <select id="wifiSecurity" class="modal-input">
            <option value="WPA">WPA/WPA2</option>
            <option value="WEP">WEP</option>
            <option value="nopass">None (Open)</option>
          </select>
        </div>
      </div>
      <button class="modal-btn" onclick="generateWiFi()">Generate WiFi QR</button>
    </div>
  </div>

  <div class="modal-overlay" id="vcardModal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title">vCard QR Code</span>
        <button class="modal-close" onclick="closeModal('vcardModal')">×</button>
      </div>
      <div class="modal-body">
        <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 16px; line-height: 1.5;">
          Share your contact information instantly. When scanned, this QR code adds your details directly to someone's contacts app.
        </p>
        <div class="modal-input-group">
          <label class="modal-label">Full Name</label>
          <input type="text" id="vcardName" class="modal-input" placeholder="John Doe" />
        </div>
        <div class="modal-input-group">
          <label class="modal-label">Phone Number</label>
          <div class="phone-input-wrapper">
            <input type="text" id="vcardAreaCode" class="area-code-input" placeholder="+1" />
            <input type="tel" id="vcardPhone" class="modal-input" placeholder="2345678900" style="flex: 1;" />
          </div>
        </div>
        <div class="modal-input-group">
          <label class="modal-label">Email</label>
          <input type="email" id="vcardEmail" class="modal-input" placeholder="contact.herovibes@gmail.com" />
        </div>
        <div class="modal-input-group">
          <label class="modal-label">Company (Optional)</label>
          <input type="text" id="vcardCompany" class="modal-input" placeholder="HeroVibes" />
        </div>
        <div class="modal-input-group">
          <label class="modal-label">Website (Optional)</label>
          <input type="url" id="vcardWebsite" class="modal-input" placeholder="https://herovibes.store" />
        </div>
      </div>
      <button class="modal-btn" onclick="generateVCard()">Generate vCard QR</button>
    </div>
  </div>

  <div class="modal-overlay" id="emailModal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title">Email QR Code</span>
        <button class="modal-close" onclick="closeModal('emailModal')">×</button>
      </div>
      <div class="modal-body">
        <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 16px; line-height: 1.5;">
          Create a QR code that opens an email compose window with pre-filled information.
        </p>
        <div class="modal-input-group">
          <label class="modal-label">Email Address</label>
          <input type="email" id="emailAddress" class="modal-input" placeholder="contact.herovibes@gmail.com" />
        </div>
        <div class="modal-input-group">
          <label class="modal-label">Subject (Optional)</label>
          <input type="text" id="emailSubject" class="modal-input" placeholder="Hello!" />
        </div>
        <div class="modal-input-group">
          <label class="modal-label">Message (Optional)</label>
          <textarea id="emailBody" class="modal-input" rows="3" placeholder="Your message here..."></textarea>
        </div>
      </div>
      <button class="modal-btn" onclick="generateEmail()">Generate Email QR</button>
    </div>
  </div>

  <div class="modal-overlay" id="smsModal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title">SMS QR Code</span>
        <button class="modal-close" onclick="closeModal('smsModal')">×</button>
      </div>
      <div class="modal-body">
        <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 16px; line-height: 1.5;">
          Create a QR code that opens a text message with pre-filled content.
        </p>
        <div class="modal-input-group">
          <label class="modal-label">Phone Number</label>
          <div class="phone-input-wrapper">
            <input type="text" id="smsAreaCode" class="area-code-input" placeholder="+1" />
            <input type="tel" id="smsNumber" class="modal-input" placeholder="2345678900" style="flex: 1;" />
          </div>
        </div>
        <div class="modal-input-group">
          <label class="modal-label">Message (Optional)</label>
          <textarea id="smsMessage" class="modal-input" rows="3" placeholder="Your message here..."></textarea>
        </div>
      </div>
      <button class="modal-btn" onclick="generateSMS()">Generate SMS QR</button>
    </div>
  </div>

  <div class="modal-overlay" id="phoneModal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title">Phone QR Code</span>
        <button class="modal-close" onclick="closeModal('phoneModal')">×</button>
      </div>
      <div class="modal-body">
        <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 16px; line-height: 1.5;">
          Create a QR code that instantly dials a phone number when scanned.
        </p>
        <div class="modal-input-group">
          <label class="modal-label">Phone Number</label>
          <div class="phone-input-wrapper">
            <input type="text" id="phoneAreaCode" class="area-code-input" placeholder="+1" />
            <input type="tel" id="phoneNumber" class="modal-input" placeholder="2345678900" style="flex: 1;" />
          </div>
          <div class="modal-help">Enter country code and phone number separately</div>
        </div>
      </div>
      <button class="modal-btn" onclick="generatePhone()">Generate Phone QR</button>
    </div>
  </div>

  <script>
    // DOM ELEMENTS
    const input = document.getElementById('qrInput');
    const img = document.getElementById('qrImage');
    const canvas = document.getElementById('qrCanvas');
    const wrapper = document.getElementById('previewWrapper');
    const downloadBtn = document.getElementById('downloadButton');
    const floatingQrBtn = document.getElementById('floatingQrBtn');
    const qrPreviewColumn = document.getElementById('qrPreviewColumn');
    
    const colorPicker = document.getElementById('colorPicker');
    const customColorInput = document.getElementById('customColor');
    const bgColorPicker = document.getElementById('bgColorPicker');
    const customBgInput = document.getElementById('customBgColor');
    const colorRadios = document.querySelectorAll('input[name="colorOption"]');
    const bgRadios = document.querySelectorAll('input[name="bgToggle"]');
    
    const gradientInputs = document.getElementById('gradientInputs');
    const gradientPicker1 = document.getElementById('gradientPicker1');
    const gradientColor1 = document.getElementById('gradientColor1');
    const gradientPicker2 = document.getElementById('gradientPicker2');
    const gradientColor2 = document.getElementById('gradientColor2');
    
    const logoInput = document.getElementById('logoInput');
    const logoPreview = document.getElementById('logoPreview');
    const logoRemoveBtn = document.getElementById('logoRemoveBtn');
    
    const templateBtns = document.querySelectorAll('.template-btn');
    
    const historyContainer = document.getElementById('historyContainer');
    const historyList = document.getElementById('historyList');
    const historyClearBtn = document.getElementById('historyClearBtn');

    const vcardAreaCode = document.getElementById('vcardAreaCode');
    const smsAreaCode = document.getElementById('smsAreaCode');
    const phoneAreaCode = document.getElementById('phoneAreaCode');

    // STATE
    let currentLogo = null;
    let currentQRData = null;
    let currentTemplate = 'url';

    // AUTO-ADD "+" TO AREA CODE
    function formatAreaCode(input) {
      input.addEventListener('input', (e) => {
        let value = e.target.value.trim();
        value = value.replace(/[^\d+]/g, '');
        if (value && !value.startsWith('+')) {
          value = '+' + value;
        }
        e.target.value = value;
      });
    }

    formatAreaCode(vcardAreaCode);
    formatAreaCode(smsAreaCode);
    formatAreaCode(phoneAreaCode);

    // TEMPLATE BUTTON ACTIVATION
    function setActiveTemplate(template) {
      currentTemplate = template;
      templateBtns.forEach(btn => {
        if (btn.dataset.template === template) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }

    // FLOATING QR BUTTON
    floatingQrBtn.addEventListener('click', () => {
      qrPreviewColumn.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    // COLOR PICKER SYNC
    colorPicker.addEventListener('input', (e) => {
      customColorInput.value = e.target.value.toUpperCase();
      updateQRCode();
    });

    customColorInput.addEventListener('input', (e) => {
      let hex = e.target.value.trim();
      if (hex.startsWith('#') && (hex.length === 7 || hex.length === 4)) {
        colorPicker.value = hex;
      }
      updateQRCode();
    });

    bgColorPicker.addEventListener('input', (e) => {
      customBgInput.value = e.target.value.toUpperCase();
      updateQRCode();
    });

    customBgInput.addEventListener('input', (e) => {
      let hex = e.target.value.trim();
      if (hex.startsWith('#') && (hex.length === 7 || hex.length === 4)) {
        bgColorPicker.value = hex;
      }
      updateQRCode();
    });

    gradientPicker1.addEventListener('input', (e) => {
      gradientColor1.value = e.target.value.toUpperCase();
      updateQRCode();
    });

    gradientColor1.addEventListener('input', (e) => {
      let hex = e.target.value.trim();
      if (hex.startsWith('#') && (hex.length === 7 || hex.length === 4)) {
        gradientPicker1.value = hex;
      }
      updateQRCode();
    });

    gradientPicker2.addEventListener('input', (e) => {
      gradientColor2.value = e.target.value.toUpperCase();
      updateQRCode();
    });

    gradientColor2.addEventListener('input', (e) => {
      let hex = e.target.value.trim();
      if (hex.startsWith('#') && (hex.length === 7 || hex.length === 4)) {
        gradientPicker2.value = hex;
      }
      updateQRCode();
    });

    // TEMPLATE MODAL FUNCTIONS
    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
      scheduleHeightCheck();
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
      setActiveTemplate('url');
      scheduleHeightCheck();
    }

    templateBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const template = btn.dataset.template;
        setActiveTemplate(template);
        
        if (template === 'url') {
          input.focus();
        } else if (template === 'wifi') {
          openModal('wifiModal');
        } else if (template === 'vcard') {
          openModal('vcardModal');
        } else if (template === 'email') {
          openModal('emailModal');
        } else if (template === 'sms') {
          openModal('smsModal');
        } else if (template === 'phone') {
          openModal('phoneModal');
        }
      });
    });

    document.querySelectorAll('.modal-overlay').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.remove('active');
          setActiveTemplate('url');
          scheduleHeightCheck();
        }
      });
    });

    // TEMPLATE GENERATORS
    function generateWiFi() {
      const ssid = document.getElementById('wifiSSID').value.trim();
      const password = document.getElementById('wifiPassword').value.trim();
      const security = document.getElementById('wifiSecurity').value;
      
      if (!ssid) {
        alert('Please enter a network name');
        return;
      }
      
      const wifiString = `WIFI:T:${security};S:${ssid};P:${password};;`;
      input.value = wifiString;
      closeModal('wifiModal');
      setActiveTemplate('wifi');
      updateQRCode();
    }

    function generateVCard() {
      const name = document.getElementById('vcardName').value.trim();
      const areaCode = document.getElementById('vcardAreaCode').value.trim();
      const phone = document.getElementById('vcardPhone').value.trim();
      const email = document.getElementById('vcardEmail').value.trim();
      const company = document.getElementById('vcardCompany').value.trim();
      const website = document.getElementById('vcardWebsite').value.trim();
      
      if (!name) {
        alert('Please enter a name');
        return;
      }
      
      let vcard = 'BEGIN:VCARD\nVERSION:3.0\n';
      vcard += `FN:${name}\n`;
      if (phone) vcard += `TEL:${areaCode}${phone}\n`;
      if (email) vcard += `EMAIL:${email}\n`;
      if (company) vcard += `ORG:${company}\n`;
      if (website) vcard += `URL:${website}\n`;
      vcard += 'END:VCARD';
      
      input.value = vcard;
      closeModal('vcardModal');
      setActiveTemplate('vcard');
      updateQRCode();
    }

    function generateEmail() {
      const address = document.getElementById('emailAddress').value.trim();
      const subject = document.getElementById('emailSubject').value.trim();
      const body = document.getElementById('emailBody').value.trim();
      
      if (!address) {
        alert('Please enter an email address');
        return;
      }
      
      let mailto = `mailto:${address}`;
      const params = [];
      if (subject) params.push(`subject=${encodeURIComponent(subject)}`);
      if (body) params.push(`body=${encodeURIComponent(body)}`);
      if (params.length > 0) mailto += '?' + params.join('&');
      
      input.value = mailto;
      closeModal('emailModal');
      setActiveTemplate('email');
      updateQRCode();
    }

    function generateSMS() {
      const areaCode = document.getElementById('smsAreaCode').value.trim();
      const number = document.getElementById('smsNumber').value.trim();
      const message = document.getElementById('smsMessage').value.trim();
      
      if (!number) {
        alert('Please enter a phone number');
        return;
      }
      
      let sms = `sms:${areaCode}${number}`;
      if (message) sms += `?body=${encodeURIComponent(message)}`;
      
      input.value = sms;
      closeModal('smsModal');
      setActiveTemplate('sms');
      updateQRCode();
    }

    function generatePhone() {
      const areaCode = document.getElementById('phoneAreaCode').value.trim();
      const number = document.getElementById('phoneNumber').value.trim();
      
      if (!number) {
        alert('Please enter a phone number');
        return;
      }
      
      input.value = `tel:${areaCode}${number}`;
      closeModal('phoneModal');
      setActiveTemplate('phone');
      updateQRCode();
    }

    // LOGO FUNCTIONS
    logoInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (event) => {
        const logoImg = new Image();
        logoImg.onload = () => {
          currentLogo = logoImg;
          logoPreview.innerHTML = `<img src="${event.target.result}" alt="Logo">`;
          logoRemoveBtn.style.display = 'block';
          updateQRCode();
        };
        logoImg.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    logoRemoveBtn.addEventListener('click', () => {
      currentLogo = null;
      logoPreview.innerHTML = '<span class="logo-preview-empty">No logo</span>';
      logoRemoveBtn.style.display = 'none';
      logoInput.value = '';
      updateQRCode();
    });

    // COLOR FUNCTIONS
    function getSelectedColor() {
      const selected = document.querySelector('input[name="colorOption"]:checked').value;
      if (selected === 'gradient') {
        return 'gradient';
      }
      if (selected === 'custom') {
        let hex = customColorInput.value.trim();
        if (!hex.startsWith('#')) hex = '#' + hex;
        return hex.toUpperCase();
      }
      return selected;
    }

    function getBackgroundColor() {
      const selected = document.querySelector('input[name="bgToggle"]:checked').value;
      if (selected === 'transparent') return '#00000000';
      if (selected === 'custom') {
        let hex = customBgInput.value.trim();
        if (!hex.startsWith('#')) hex = '#' + hex;
        return hex.toUpperCase();
      }
      return selected;
    }

    function updatePreviewBackground(bgColor) {
      const isTransparent = bgColor === '#00000000';
      wrapper.classList.toggle('transparent-bg', isTransparent);
      
      if (!isTransparent) {
        wrapper.style.backgroundColor = bgColor;
      } else {
        wrapper.style.backgroundColor = '';
      }
    }

    colorRadios.forEach(radio => {
      radio.addEventListener('change', () => {
        if (radio.value === 'gradient') {
          gradientInputs.classList.add('active');
        } else {
          gradientInputs.classList.remove('active');
        }
        updateQRCode();
      });
    });

    // HELPER FUNCTION FOR GRADIENT COLOR COMPUTATION
    function hexToRgb(hex) {
      hex = hex.replace('#', '');
      const r = parseInt(hex.substr(0, 2), 16);
      const g = parseInt(hex.substr(2, 2), 16);
      const b = parseInt(hex.substr(4, 2), 16);
      return { r, g, b };
    }

    function getGradientColor(t, color1, color2) {
      const c1 = hexToRgb(color1);
      const c2 = hexToRgb(color2);
      const r = Math.round(c1.r + t * (c2.r - c1.r));
      const g = Math.round(c1.g + t * (c2.g - c1.g));
      const b = Math.round(c1.b + t * (c2.b - c1.b));
      return { r, g, b };
    }

    // QR CODE GENERATION - USING SIMPLE WORKING APPROACH
    function updateQRCode() {
      const text = input.value.trim();
      
      if (!text) {
        img.classList.add('empty');
        downloadBtn.disabled = true;
        return;
      }

      const qrColor = getSelectedColor();
      const bgColor = getBackgroundColor();
      
      updatePreviewBackground(bgColor);

      // Use simple toDataURL approach that works from old version
      if (qrColor === 'gradient') {
        // For gradient, generate with transparent background, then apply gradient to modules
        QRCode.toDataURL(text, {
          width: 800,
          margin: 2,
          color: {
            dark: '#000000',
            light: '#00000000'
          },
          errorCorrectionLevel: 'H'
        }, (err, url) => {
          if (err) {
            console.error('QR Code generation error:', err);
            return;
          }
          
          // Apply gradient to the generated QR
          applyGradientToQR(url, bgColor, text);
        });
      } else {
        // For solid colors, use direct generation
        QRCode.toDataURL(text, {
          width: 800,
          margin: 2,
          color: {
            dark: qrColor,
            light: bgColor
          },
          errorCorrectionLevel: 'H'
        }, (err, url) => {
          if (err) {
            console.error('QR Code generation error:', err);
            return;
          }
          
          // If there's a logo, add it
          if (currentLogo) {
            addLogoToQR(url, text);
          } else {
            img.src = url;
            img.classList.remove('empty');
            downloadBtn.disabled = false;
            currentQRData = { text, dataUrl: url, timestamp: Date.now() };
          }
        });
      }
    }

    function applyGradientToQR(dataUrl, bgColor, text) {
      const tempImg = new Image();
      tempImg.onload = () => {
        canvas.width = 800;
        canvas.height = 800;
        const ctx = canvas.getContext('2d');
        
        // Fill background if not transparent
        if (bgColor !== '#00000000') {
          ctx.fillStyle = bgColor;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        
        // Create temporary canvas to detect module positions (where alpha > 0)
        const moduleCanvas = document.createElement('canvas');
        moduleCanvas.width = canvas.width;
        moduleCanvas.height = canvas.height;
        const moduleCtx = moduleCanvas.getContext('2d');
        moduleCtx.drawImage(tempImg, 0, 0);
        const moduleImageData = moduleCtx.getImageData(0, 0, canvas.width, canvas.height);
        const moduleData = moduleImageData.data;
        
        // Get final image data after background fill
        const finalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const finalData = finalImageData.data;
        
        // Prepare colors for vertical gradient (top to bottom)
        let color1 = gradientColor1.value.trim();
        if (!color1.startsWith('#')) color1 = '#' + color1;
        let color2 = gradientColor2.value.trim();
        if (!color2.startsWith('#')) color2 = '#' + color2;
        
        // Apply gradient to module pixels efficiently
        for (let y = 0; y < canvas.height; y++) {
          for (let x = 0; x < canvas.width; x++) {
            const i = (y * canvas.width + x) * 4;
            // Check if this pixel is part of a module (alpha > 0 in module detection)
            if (moduleData[i + 3] > 0) {
              const t = y / canvas.height;  // Vertical gradient parameter
              const col = getGradientColor(t, color1, color2);
              finalData[i] = col.r;
              finalData[i + 1] = col.g;
              finalData[i + 2] = col.b;
              finalData[i + 3] = 255;
            }
          }
        }
        
        // Put the modified image data back
        ctx.putImageData(finalImageData, 0, 0);
        
        const finalUrl = canvas.toDataURL('image/png');
        
        if (currentLogo) {
          addLogoToQR(finalUrl, text);
        } else {
          img.src = finalUrl;
          img.classList.remove('empty');
          downloadBtn.disabled = false;
          currentQRData = { text, dataUrl: finalUrl, timestamp: Date.now() };
        }
      };
      tempImg.src = dataUrl;
    }

    function addLogoToQR(dataUrl, text) {
      const tempImg = new Image();
      tempImg.onload = () => {
        canvas.width = 800;
        canvas.height = 800;
        const ctx = canvas.getContext('2d');
        
        // Draw the QR code
        ctx.drawImage(tempImg, 0, 0);
        
        // Add logo with white background
        const logoSize = canvas.width * 0.2;
        const logoX = (canvas.width - logoSize) / 2;
        const logoY = (canvas.height - logoSize) / 2;
        
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(logoX - 10, logoY - 10, logoSize + 20, logoSize + 20);
        
        ctx.drawImage(currentLogo, logoX, logoY, logoSize, logoSize);
        
        const finalUrl = canvas.toDataURL('image/png');
        img.src = finalUrl;
        img.classList.remove('empty');
        downloadBtn.disabled = false;
        currentQRData = { text, dataUrl: finalUrl, timestamp: Date.now() };
      };
      tempImg.src = dataUrl;
    }

    // DOWNLOAD FUNCTION
    function downloadQRCode() {
      const url = img.src;
      if (!url || !currentQRData) return;

      const a = document.createElement('a');
      a.href = url;
      a.download = 'herovibes-qr-code.png';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      
      saveToHistory(currentQRData);
    }

    // HISTORY FUNCTIONS
    function saveToHistory(qrData) {
      let history = JSON.parse(localStorage.getItem('qrHistory') || '[]');
      
      history.unshift({
        text: qrData.text,
        dataUrl: qrData.dataUrl,
        timestamp: qrData.timestamp
      });
      
      history = history.slice(0, 5);
      
      localStorage.setItem('qrHistory', JSON.stringify(history));
      renderHistory(true);
    }

    function renderHistory(animateNew = false) {
      let history = JSON.parse(localStorage.getItem('qrHistory') || '[]');
      
      if (history.length === 0) {
        historyContainer.classList.remove('active');
        scheduleHeightCheck();
        return;
      }
      
      historyContainer.classList.add('active');
      historyList.innerHTML = '';
      
      history.forEach((item, index) => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        
        const date = new Date(item.timestamp);
        const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        
        let displayText = item.text;
        if (displayText.length > 50) {
          displayText = displayText.substring(0, 50) + '...';
        }
        
        historyItem.innerHTML = `
          <div class="history-thumbnail">
            <img src="${item.dataUrl}" alt="QR Code">
          </div>
          <div class="history-info">
            <div class="history-url" title="${item.text}">${displayText}</div>
            <div class="history-date">${dateStr}</div>
          </div>
          <div class="history-actions">
            <button class="history-action-btn" onclick="redownloadQR(${index})">Download</button>
            <button class="history-action-btn" onclick="removeFromHistory(${index})">✕</button>
          </div>
        `;
        
        historyList.appendChild(historyItem);
      });
      
      scheduleHeightCheck();
    }

    function redownloadQR(index) {
      let history = JSON.parse(localStorage.getItem('qrHistory') || '[]');
      const item = history[index];
      if (!item) return;
      
      const a = document.createElement('a');
      a.href = item.dataUrl;
      a.download = 'herovibes-qr-code.png';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    function removeFromHistory(index) {
      const items = historyList.querySelectorAll('.history-item');
      if (items[index]) {
        items[index].classList.add('removing');
        
        setTimeout(() => {
          let history = JSON.parse(localStorage.getItem('qrHistory') || '[]');
          history.splice(index, 1);
          localStorage.setItem('qrHistory', JSON.stringify(history));
          renderHistory();
        }, 300);
      }
    }

    function clearHistory() {
      if (confirm('Clear all QR code history?')) {
        const items = historyList.querySelectorAll('.history-item');
        items.forEach(item => item.classList.add('removing'));
        
        setTimeout(() => {
          localStorage.removeItem('qrHistory');
          renderHistory();
        }, 300);
      }
    }

    // EVENT LISTENERS
    input.addEventListener('input', updateQRCode);
    bgRadios.forEach(radio => radio.addEventListener('change', updateQRCode));
    downloadBtn.addEventListener('click', downloadQRCode);
    historyClearBtn.addEventListener('click', clearHistory);

    // INITIALIZATION
    window.addEventListener('load', () => {
      input.focus();
      renderHistory();
      
      if (input.value.trim()) {
        updateQRCode();
      }
    });

    // FOURTHWALL SCROLLBAR FIX
    let lastHeight = 0;
    let resizeTimer;

    function sendHeight() {
      const height = document.body.scrollHeight;
      
      if (height !== lastHeight) {
        lastHeight = height;
        window.parent.postMessage({ frameHeight: height }, '*');
      }
    }

    function scheduleHeightCheck() {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(sendHeight, 150);
    }

    window.addEventListener('load', () => {
      setTimeout(sendHeight, 100);
    });

    window.addEventListener('resize', () => {
      scheduleHeightCheck();
    });
  </script>
</body>
</html>
