<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* ===== GLOBAL STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #191919;
            font-family: sans-serif;
            padding: 24px 16px;
            color: #D4D4D4;
            /* Removed min-height: 100vh per troubleshooting guide */
        }

        /* ===== MAIN CONTAINER ===== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
        }

        /* ===== VERSION NUMBER ===== */
        .version {
            position: fixed;
            bottom: 8px;
            right: 8px;
            font-size: 10px;
            color: #8C8C8C;
            opacity: 0.5;
            user-select: none;
            z-index: 1000;
        }

        /* ===== STATUS MESSAGE ===== */
        .status-message {
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 12px;
            display: none;
        }

        .status-message.error {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid rgba(255, 59, 48, 0.3);
            color: #FF3B30;
            display: block;
        }

        .status-message.success {
            background: rgba(52, 199, 89, 0.1);
            border: 1px solid rgba(52, 199, 89, 0.3);
            color: #34C759;
            display: block;
        }

        .status-message.info {
            background: rgba(135, 169, 255, 0.1);
            border: 1px solid rgba(135, 169, 255, 0.3);
            color: #87A9FF;
            display: block;
        }

        /* ===== TWO COLUMN LAYOUT (DESKTOP) ===== */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        @media (min-width: 900px) {
            .content-wrapper {
                grid-template-columns: 1fr 600px;
            }

            .preview-section {
                order: 2;
                position: sticky;
                top: 16px;
                align-self: start;
            }

            .settings-column {
                order: 1;
            }
        }

        /* ===== TAB SYSTEM ===== */
        .tab-container {
            background: #1F1F1F;
            border: 1px solid #323232;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .tab-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .tab-btn {
            position: relative;
            padding: 10px 16px;
            border-radius: 8px;
            background: #191919;
            color: #8C8C8C;
            border: 1px solid #323232;
            cursor: pointer;
            overflow: hidden;
            font-size: 14px;
            font-family: sans-serif;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: #1F1F1F;
            color: #87A9FF;
            border-color: #87A9FF;
        }

        .tab-btn:hover {
            background: #323232;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ===== DISCLAIMER ===== */
        .disclaimer {
            background: rgba(135, 169, 255, 0.1);
            border: 1px solid rgba(135, 169, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            font-size: 11px;
            color: #8C8C8C;
            line-height: 1.5;
        }

        .disclaimer strong {
            color: #87A9FF;
        }

        /* ===== INPUT SECTION ===== */
        .input-section {
            background: #1F1F1F;
            border: 1px solid #323232;
            border-radius: 8px;
            padding: 24px 16px;
            margin-bottom: 16px;
        }

        .section-header {
            font-size: 14px;
            font-weight: bold;
            color: #D4D4D4;
            margin-bottom: 16px;
        }

        .input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .input-group.column {
            flex-direction: column;
        }

        .input-group input[type="text"],
        .input-group textarea {
            flex: 1;
            background: #191919;
            border: 1px solid #323232;
            border-radius: 8px;
            padding: 10px 16px;
            color: #D4D4D4;
            font-size: 14px;
            font-family: sans-serif;
        }

        .input-group input[type="number"],
        .input-group input[type="date"] {
            background: #191919;
            border: 1px solid #323232;
            border-radius: 8px;
            padding: 10px 16px;
            color: #D4D4D4;
            font-size: 14px;
            font-family: sans-serif;
            color-scheme: dark;
        }

        /* Remove number input arrows */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        .input-group textarea {
            min-height: 120px;
            resize: vertical;
            font-size: 14px;
            line-height: 1.4;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #87A9FF;
        }

        .input-group input::placeholder,
        .input-group textarea::placeholder {
            color: #8C8C8C;
        }

        .input-label {
            font-size: 12px;
            color: #8C8C8C;
            margin-bottom: 8px;
            display: block;
        }

        /* ===== LABEL WITH CHECKBOX ===== */
        .label-with-checkbox {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .label-with-checkbox .input-label {
            margin-bottom: 0;
        }

        .checkbox-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .checkbox-toggle input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #87A9FF;
        }

        .checkbox-toggle label {
            font-size: 11px;
            color: #8C8C8C;
            cursor: pointer;
            user-select: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .stats-grid .input-group {
            margin-bottom: 0;
        }

        /* ===== FILE UPLOAD ===== */
        .file-upload-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .file-upload-btn {
            position: relative;
            padding: 10px 16px;
            border-radius: 8px;
            background: #1F1F1F;
            color: #D4D4D4;
            border: 1px solid rgba(255,255,255,0.06);
            cursor: pointer;
            overflow: hidden;
            font-size: 14px;
            font-family: sans-serif;
            white-space: nowrap;
        }

        .file-upload-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 75%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            transform: skewX(-25deg);
            transition: left 0.7s ease-in-out;
        }

        .file-upload-btn:hover::before {
            left: 125%;
        }

        .file-upload-btn input[type="file"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .upload-preview {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #323232;
        }

        .file-name {
            font-size: 12px;
            color: #8C8C8C;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* ===== BUTTONS ===== */
        .btn {
            position: relative;
            padding: 10px 16px;
            border-radius: 8px;
            background: #1F1F1F;
            color: #D4D4D4;
            border: 1px solid rgba(255,255,255,0.06);
            cursor: pointer;
            overflow: hidden;
            font-size: 14px;
            font-family: sans-serif;
            white-space: nowrap;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 75%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            transform: skewX(-25deg);
            transition: left 0.7s ease-in-out;
        }

        .btn:hover::before {
            left: 125%;
        }

        .btn:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(135,169,255,0.12);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn:disabled::before {
            display: none;
        }

        /* ===== CUSTOMIZATION OPTIONS ===== */
        .customization-section {
            background: #1F1F1F;
            border: 1px solid #323232;
            border-radius: 8px;
            padding: 24px 16px;
            margin-bottom: 16px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .option-item input[type="checkbox"],
        .option-item input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #87A9FF;
        }

        .option-item label {
            font-size: 12px;
            color: #D4D4D4;
            cursor: pointer;
            user-select: none;
        }

        /* ===== PREVIEW AREA ===== */
        .preview-section {
            background: #1F1F1F;
            border: 1px solid #323232;
            border-radius: 8px;
            padding: 24px 16px;
            margin-bottom: 16px;
        }

        .preview-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            padding: 20px;
            transition: background-color 0.3s ease;
        }

        .preview-container.dark-bg {
            background-color: #15202B;
        }

        .preview-container.light-bg {
            background-color: #F7F9FA;
        }

        .preview-container.transparent-bg {
            background-image: 
                linear-gradient(45deg, #2a2a2a 25%, transparent 25%), 
                linear-gradient(-45deg, #2a2a2a 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #2a2a2a 75%), 
               
  linear-gradient(-45deg, transparent 75%, #2a2a2a 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        /* ===== TWEET CARD ===== */
        #tweet-card {
            max-width: 600px;
            width: 100%;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        #tweet-card.rounded-corners {
            border-radius: 24px;
        }

        /* Light Mode Card */
        #tweet-card.light-mode {
            background: #FFFFFF;
        }

        #tweet-card.light-mode .author-name {
            color: #14171A;
        }

        #tweet-card.light-mode .author-username {
            color: #657786;
        }

        #tweet-card.light-mode .tweet-text {
            color: #14171A;
        }

        #tweet-card.light-mode .tweet-stats {
            border-top-color: #E1E8ED;
        }

        #tweet-card.light-mode .stat-item {
            color: #657786;
        }

        #tweet-card.light-mode .stat-value {
            color: #14171A;
        }

        /* Dark Mode Card */
        #tweet-card.dark-mode {
            background: #192734;
        }

        #tweet-card.dark-mode .author-name {
            color: #FFFFFF;
        }

        #tweet-card.dark-mode .author-username {
            color: #8B98A5;
        }

        #tweet-card.dark-mode .tweet-text {
            color: #FFFFFF;
        }

        #tweet-card.dark-mode .tweet-stats {
            border-top-color: #2F3336;
        }

        #tweet-card.dark-mode .stat-item {
            color: #8B98A5;
        }

        #tweet-card.dark-mode .stat-value {
            color: #FFFFFF;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .profile-pic {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            /* MODIFIED: Replaced object-fit with background-size for html2canvas bug */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-color: #E1E8ED; /* Fallback color */
            flex-shrink: 0;
        }

        .author-info {
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .author-name {
            font-size: 15px;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .author-username {
            font-size: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tweet-text {
            font-size: 23px;
            line-height: 1.4;
            word-wrap: break-word;
            margin-bottom: 12px;
            white-space: pre-wrap;
        }

        .tweet-mention,
        .tweet-hashtag {
            color: #1DA1F2;
        }

        .tweet-stats {
            display: flex;
            gap: 16px;
            padding-top: 12px;
            font-size: 15px;
            border-top: 1px solid;
        }

        .stat-item {
            display: flex;
            gap: 4px;
        }

        .stat-value {
            font-weight: bold;
        }

        /* ===== VISIBILITY TOGGLES ===== */
        .hide-profile-pic .profile-pic {
            display: none;
        }

        .hide-likes .stat-likes {
            display: none;
        }

        .hide-retweets .stat-retweets {
            display: none;
        }

        .hide-date .stat-date {
            display: none;
        }

        /* ===== DOWNLOAD SECTION ===== */
        .download-section {
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        /* ===== MOBILE RESPONSIVE ===== */
        @media (max-width: 768px) {
            body {
                padding: 16px 12px;
            }

            .tab-container,
            .input-section,
            .customization-section,
            .preview-section {
                padding: 16px 12px;
            }

            .input-group {
                flex-direction: column;
            }

            .tab-buttons {
                flex-wrap: wrap;
            }

            #tweet-card {
                padding: 16px;
            }

            .tweet-text {
                font-size: 18px;
            }

            .tweet-stats {
                flex-wrap: wrap;
                gap: 12px;
            }

            .download-section {
                flex-direction: column;
            }

            .download-section .btn {
                width: 100%;
            }

            .file-upload-container {
                flex-direction: column;
                align-items: flex-start;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            /* Mobile: Preview at top */
            .content-wrapper {
                display: flex;
                flex-direction: column;
            }

            .preview-section {
                order: -1;
            }

            .version {
                position: static;
                text-align: center;
                margin-top: 16px;
                opacity: 0.3;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="version">v1.0.2</div>

        <div id="status-message" class="status-message"></div>

        <div class="content-wrapper">
            <div class="settings-column">
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="custom-tab">Custom Tweet</button>
              
           <button class="tab-btn" data-tab="url-tab">From URL</button>
                    </div>

                    <div id="custom-tab" class="tab-content active">
                    
     <div class="input-group column">
                            <label class="input-label">Display Name</label>
                            <input 
                                type="text" 
  
                               id="custom-name" 
                                placeholder="Enter display name..."
                                value="Your Name"
  
                           >
                        </div>

                        <div class="input-group column">
                        
     <label class="input-label">Username (without @)</label>
                            <input 
                                type="text" 
                               
  id="custom-username" 
                                placeholder="Enter username..."
                                value="yourusername"
                            >
     
                    </div>

                        <div class="input-group column">
                            <label class="input-label">Tweet Text</label>
                         
    <textarea 
                                id="custom-text" 
                                placeholder="Enter your tweet text here..."
                           
  >This is your custom tweet! You can write anything you want here and it will appear in the preview.
 Try adding @mentions and #hashtags!</textarea>
                        </div>

                        <div class="input-group column">
                            <div class="label-with-checkbox">
                 
                <label class="input-label">Profile Picture</label>
                                <div class="checkbox-toggle">
                                    <input type="checkbox" id="show-profile-pic" checked>
           
                          <label for="show-profile-pic">Show</label>
                                </div>
                            </div>
              
               <div class="file-upload-container">
                                <label class="file-upload-btn">
                                    Choose Image
               
                      <input type="file" id="profile-upload" accept="image/*">
                                </label>
                                <img 
           
                          id="upload-preview" 
                                    class="upload-preview" 
                                    src="data:image/svg+xml,%3Csvg 
 xmlns='http://www.w3.org/2000/svg' width='48' height='48'%3E%3Crect fill='%231DA1F2' width='48' height='48'/%3E%3Ctext x='24' y='32' text-anchor='middle' fill='white' font-size='20' font-family='sans-serif' font-weight='bold'%3EYN%3C/text%3E%3C/svg%3E"
                                    alt="Preview"
                                >
                    
             <span class="file-name" id="file-name">No file chosen</span>
                            </div>
                        </div>

                        <div class="input-group column">
      
                       <label class="input-label">Engagement Stats</label>
                            <div class="stats-grid">
                                <div class="input-group column" style="gap: 8px;">
           
                          <div class="label-with-checkbox">
                                        <label class="input-label" style="margin: 0;">Retweets</label>
                               
          <div class="checkbox-toggle">
                                            <input type="checkbox" id="show-retweets" checked>
                                           
  <label for="show-retweets">Show</label>
                                        </div>
                                    </div>
                      
               <input 
                                        type="number" 
                                        id="custom-retweets" 
   
                                      placeholder="0"
                                        value="123"
                       
                  min="0"
                                    >
                                </div>
               
                  <div class="input-group column" style="gap: 8px;">
                                    <div class="label-with-checkbox">
                                        <label class="input-label" 
 style="margin: 0;">Likes</label>
                                        <div class="checkbox-toggle">
                                            <input type="checkbox" id="show-likes" checked>
           
                                  <label for="show-likes">Show</label>
                                        </div>
                          
           </div>
                                    <input 
                                        type="number" 
            
                             id="custom-likes" 
                                        placeholder="0"
                               
          value="456"
                                        min="0"
                                    >
               
                  </div>
                                <div class="input-group column" style="gap: 8px;">
                                    <div class="label-with-checkbox">
          
                               <label class="input-label" style="margin: 0;">Date</label>
                                        <div class="checkbox-toggle">
                          
                   <input type="checkbox" id="show-date" checked>
                                            <label for="show-date">Show</label>
                                  
       </div>
                                    </div>
                                    <input 
                     
                    type="date" 
                                        id="custom-date"
                                    >
    
                             </div>
                            </div>
                        </div>
                    
 </div>

                    <div id="url-tab" class="tab-content">
                        <div class="disclaimer">
                            <strong>Note:</strong> 
 Due to Twitter/X API restrictions, we can only fetch basic tweet text and author information.
 Profile pictures and tweet images cannot be retrieved without API authentication.
 For best results, use the Custom Tweet tab to create fully customized tweet images.
 </div>
                        <div class="input-group">
                            <input 
                                type="text" 
             
                    id="tweet-url" 
                                placeholder="Paste Tweet or X.com URL here..."
                                autocomplete="off"
           
                  >
                            <button class="btn" id="load-tweet">Generate</button>
                        </div>
                    </div>
         
        </div>

                <div class="customization-section">
                    <div class="section-header">Appearance</div>
                    <div class="options-grid">
               
          <div class="option-item">
                            <input type="radio" id="theme-light" name="theme" value="light" checked>
                            <label for="theme-light">Light Mode</label>
                        </div>
   
                      <div class="option-item">
                            <input type="radio" id="theme-dark" name="theme" value="dark">
                            <label for="theme-dark">Dark Mode</label>
                
         </div>
                        <div class="option-item">
                            <input type="checkbox" id="rounded-corners">
                            <label for="rounded-corners">Rounded Corners (Transparent BG)</label>
     
                    </div>
                    </div>
                </div>

                <div class="download-section">
         
            <button class="btn" id="download-image">Download as PNG</button>
                </div>
            </div>

            <div class="preview-section">
                <div class="preview-container light-bg" id="preview-container">
          
           <div id="tweet-card" class="light-mode">
                        <div class="card-header">
                            <div
                                class="profile-pic" 
                                id="preview-profile-pic"
                                style="background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'48\' height=\'48\'%3E%3Crect fill=\'%231DA1F2\' width=\'48\' height=\'48\'/%3E%3Ctext x=\'24\' y=\'32\' text-anchor=\'middle\' fill=\'white\' font-size=\'20\' font-family=\'sans-serif\' font-weight=\'bold\'%3EYN%3C/text%3E%3C/svg%3E');"
                            ></div>
                            <div class="author-info">
 
                                <div class="author-name" id="preview-author-name">Your Name</div>
                                <div class="author-username" id="preview-author-username">@yourusername</div>
                            </div>
    
                     </div>
                        <div class="tweet-text" id="preview-tweet-text">This is your custom tweet!
 You can write anything you want here and it will appear in the preview.
 Try adding <span class="tweet-mention">@mentions</span> and <span class="tweet-hashtag">#hashtags</span>!</div>
                        <div class="tweet-stats">
                            <span class="stat-item stat-retweets" id="preview-retweets">
                                <span class="stat-value">123</span> Retweets
    
                         </span>
                            <span class="stat-item stat-likes" id="preview-likes">
                                <span class="stat-value">456</span> Likes
           
                  </span>
                            <span class="stat-item stat-date" id="preview-date">
                                <span class="stat-value">Nov 15, 2025</span>
                 
            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script 
 src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script>
        // ===== ELEMENT REFERENCES =====
        const loadBtn = document.getElementById('load-tweet');
        const downloadBtn = document.getElementById('download-image');
        const tweetCard = document.getElementById('tweet-card');
        const previewContainer = document.getElementById('preview-container');
        const tweetUrl = document.getElementById('tweet-url');
        const statusMessage = document.getElementById('status-message');
        // Tab elements
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        // Custom inputs
        const customName = document.getElementById('custom-name');
        const customUsername = document.getElementById('custom-username');
        const customText = document.getElementById('custom-text');
        const customRetweets = document.getElementById('custom-retweets');
        const customLikes = document.getElementById('custom-likes');
        const customDate = document.getElementById('custom-date');
        const profileUpload = document.getElementById('profile-upload');
        const uploadPreview = document.getElementById('upload-preview');
        const fileName = document.getElementById('file-name');
        
        // Display options
        const showProfilePic = document.getElementById('show-profile-pic');
        const showLikes = document.getElementById('show-likes');
        const showRetweets = document.getElementById('show-retweets');
        const showDate = document.getElementById('show-date');
        const themeLight = document.getElementById('theme-light');
        const themeDark = document.getElementById('theme-dark');
        const roundedCorners = document.getElementById('rounded-corners');

        // Preview elements
        const previewProfilePic = document.getElementById('preview-profile-pic');
        const previewAuthorName = document.getElementById('preview-author-name');
        const previewAuthorUsername = document.getElementById('preview-author-username');
        const previewTweetText = document.getElementById('preview-tweet-text');
        const previewRetweets = document.getElementById('preview-retweets');
        const previewLikes = document.getElementById('preview-likes');
        const previewDate = document.getElementById('preview-date');

        let currentProfileImage = `url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'48\' height=\'48\'%3E%3Crect fill=\'%231DA1F2\' width=\'48\' height=\'48\'/%3E%3Ctext x=\'24\' y=\'32\' text-anchor=\'middle\' fill=\'white\' font-size=\'20\' font-family=\'sans-serif\' font-weight=\'bold\'%3EYN%3C/text%3E%3C/svg%3E')`;
        let currentMode = 'custom';
        // Set today's date
        const today = new Date().toISOString().split('T')[0];
        customDate.value = today;
        
        // ===== TAB SWITCHING =====
        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetTab = btn.dataset.tab;
                
                tabBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
  
               
                tabContents.forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(targetTab).classList.add('active');
                
 
                currentMode = targetTab === 'url-tab' ? 'url' : 'custom';
                
                if (currentMode === 'custom') {
                    updateCustomPreview();
                }
    
             
                scheduleHeightCheck();
            });
        });
 // ===== STATUS DISPLAY =====
        function showStatus(message, type = 'info') {
            // Silently skip success messages
            if (type === 'success') return;
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            scheduleHeightCheck();
            setTimeout(() => {
                statusMessage.className = 'status-message';
                scheduleHeightCheck();
            }, 5000);
 }

        // ===== EXTRACT TWEET ID =====
        function extractTweetId(url) {
            const match = url.match(/(?:twitter\.com|x\.com)\/[^\/]+\/status\/(\d+)/);
            return match ? match[1] : null;
        }

        // ===== CONVERT IMAGE TO BASE64 (CORS FIX) =====
        function imageToBase64(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
             
    img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
   
                  ctx.drawImage(img, 0, 0);
                    resolve(canvas.toDataURL('image/png'));
                };
                img.onerror = () => {
                    resolve("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48'%3E%3Crect fill='%23E1E8ED' 
 width='48' height='48'/%3E%3C/svg%3E");
                };
                img.src = url;
            });
 }

        // ===== FILE TO BASE64 =====
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
  
               reader.readAsDataURL(file);
            });
 }

        // ===== FETCH TWEET DATA =====
        async function fetchTweetData(tweetId) {
            const mockData = {
                author_name: "Tweet User",
                author_username: "@tweetuser",
                profile_image_url: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='48' height='48'%3E%3Crect fill='%231DA1F2' width='48' height='48'/%3E%3Ctext x='24' y='32' 
 text-anchor='middle' fill='white' font-size='20' font-family='sans-serif' font-weight='bold'%3ETU%3C/text%3E%3C/svg%3E",
                text: `This is a tweet from ID ${tweetId}.
 Since we can't access the Twitter API directly, this is mock data.
 You can customize how this appears using the options above!`,
                likes: Math.floor(Math.random() * 10000),
                retweets: Math.floor(Math.random() * 2000),
                date: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }),
                url: `https://twitter.com/user/status/${tweetId}`
          
   };

            try {
                const corsProxy = 'https://api.allorigins.win/raw?url=';
                const oEmbedUrl = `https://publish.twitter.com/oembed?url=https://twitter.com/anyuser/status/${tweetId}`;
                const response = await fetch(corsProxy + encodeURIComponent(oEmbedUrl));
                if (response.ok) {
                    const oEmbedData = await response.json();
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = oEmbedData.html || '';
                    
                    const tweetTextElem = tempDiv.querySelector('p');
                    if (tweetTextElem) {
                        mockData.text = tweetTextElem.innerText ||
 tweetTextElem.textContent;
                    }
                    
                    if (oEmbedData.author_name) {
                        mockData.author_name = oEmbedData.author_name;
                    }
                    
                    if (oEmbedData.author_url) {
                        const usernameMatch = oEmbedData.author_url.match(/(?:twitter\.com|x\.com)\/([^\/]+)/);
                        if (usernameMatch) {
                            mockData.author_username = `@${usernameMatch[1]}`;
                        }
                    }
                }
            } catch (error) {
                console.warn('Could not fetch oEmbed data:', error);
            }

            return mockData;
        }

        // ===== ESCAPE HTML =====
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ===== FORMAT TWEET TEXT =====
        function formatTweetText(text) {
            return text
                .replace(/@(\w+)/g, '<span class="tweet-mention">@$1</span>')
                .replace(/#(\w+)/g, '<span class="tweet-hashtag">#$1</span>');
        }

        // ===== UPDATE TWEET CARD CONTENT =====
        async function updateTweetCardContent(data) {
            if (!data) return;
            if (data.profile_image_url && !data.profile_image_url.startsWith('data:')) {
                try {
                    const base64Image = await imageToBase64(data.profile_image_url);
                    // MODIFIED: Use background-image instead of .src
                    previewProfilePic.style.backgroundImage = `url(${base64Image})`;
                    currentProfileImage = `url(${base64Image})`;
                } catch (error) {
                    // MODIFIED: Use background-image instead of .src
                    previewProfilePic.style.backgroundImage = "url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'48\' height=\'48\'%3E%3Crect fill=\'%23E1E8ED\' width=\'48\' height=\'48\'/%3E%3C/svg%3E')";
                }
            } else {
                // MODIFIED: Use background-image instead of .src
                previewProfilePic.style.backgroundImage = `url(${data.profile_image_url})`;
                currentProfileImage = `url(${data.profile_image_url})`;
            }

            previewAuthorName.textContent = data.author_name;
            previewAuthorUsername.textContent = data.author_username;
            previewTweetText.innerHTML = formatTweetText(escapeHtml(data.text));
            
            previewRetweets.innerHTML = `<span class="stat-value">${data.retweets.toLocaleString()}</span> Retweets`;
            previewLikes.innerHTML = `<span class="stat-value">${data.likes.toLocaleString()}</span> Likes`;
            previewDate.innerHTML = `<span class="stat-value">${data.date}</span>`;
            
            // MODIFIED: Added scheduleHeightCheck
            scheduleHeightCheck();
        }

        // ===== UPDATE CUSTOM PREVIEW =====
        function updateCustomPreview() {
            const name = customName.value ||
 'Your Name';
            const username = customUsername.value || 'yourusername';
            const text = customText.value || 'Enter your tweet text...';
            const retweets = parseInt(customRetweets.value) || 0;
            const likes = parseInt(customLikes.value) || 0;
            
            let dateStr = 'Nov 15, 2025';
            if (customDate.value) {
                const dateObj = new Date(customDate.value);
                dateStr = dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
            }

            previewAuthorName.textContent = name;
            previewAuthorUsername.textContent = username.startsWith('@') ?
 username : `@${username}`;
            previewTweetText.innerHTML = formatTweetText(escapeHtml(text));
            previewRetweets.innerHTML = `<span class="stat-value">${retweets.toLocaleString()}</span> Retweets`;
            previewLikes.innerHTML = `<span class="stat-value">${likes.toLocaleString()}</span> Likes`;
            previewDate.innerHTML = `<span class="stat-value">${dateStr}</span>`;
            if (currentProfileImage) {
                // MODIFIED: Use background-image instead of .src
                previewProfilePic.style.backgroundImage = currentProfileImage;
            }
            
            scheduleHeightCheck();
        }

        // ===== APPLY CUSTOMIZATIONS =====
        function applyCustomizations() {
            tweetCard.classList.toggle('hide-profile-pic', !showProfilePic.checked);
            tweetCard.classList.toggle('hide-likes', !showLikes.checked);
            tweetCard.classList.toggle('hide-retweets', !showRetweets.checked);
            tweetCard.classList.toggle('hide-date', !showDate.checked);
            scheduleHeightCheck();
        }

        // ===== APPLY THEME =====
        function applyTheme() {
            if (roundedCorners.checked) {
                previewContainer.classList.remove('light-bg', 'dark-bg');
                previewContainer.classList.add('transparent-bg');
                tweetCard.classList.add('rounded-corners');
            } else {
                previewContainer.classList.remove('transparent-bg');
                tweetCard.classList.remove('rounded-corners');
                
                if (themeLight.checked) {
                    tweetCard.classList.remove('dark-mode');
                    tweetCard.classList.add('light-mode');
                    previewContainer.classList.remove('dark-bg');
                    previewContainer.classList.add('light-bg');
                } else {
                    tweetCard.classList.remove('light-mode');
                    tweetCard.classList.add('dark-mode');
                    previewContainer.classList.remove('light-bg');
                    previewContainer.classList.add('dark-bg');
                }
            }
            scheduleHeightCheck();
        }

        // ===== PROFILE IMAGE UPLOAD =====
        profileUpload.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                try {
                    const base64 = await fileToBase64(file);
     
                    // MODIFIED: Use background-image instead of .src
                    currentProfileImage = `url(${base64})`;
                    uploadPreview.src = base64; // This one is fine as an img
                    previewProfilePic.style.backgroundImage = `url(${base64})`;
                    fileName.textContent = file.name;
                    
                    // MODIFIED: Added scheduleHeightCheck
                    scheduleHeightCheck();
                } 
 catch (error) {
                    showStatus('Error uploading image', 'error');
                }
            }
        });
 // ===== CUSTOM INPUT LISTENERS (LIVE PREVIEW) =====
        customName.addEventListener('input', updateCustomPreview);
        customUsername.addEventListener('input', updateCustomPreview);
        customText.addEventListener('input', updateCustomPreview);
        customRetweets.addEventListener('input', updateCustomPreview);
        customLikes.addEventListener('input', updateCustomPreview);
        customDate.addEventListener('change', updateCustomPreview);

        // ===== LOAD TWEET FROM URL =====
        loadBtn.addEventListener('click', async () => {
            const urlInput = tweetUrl.value.trim();
            
            if (!urlInput || (!urlInput.includes('twitter.com') && !urlInput.includes('x.com'))) {
                showStatus('Please enter a valid Tweet URL from twitter.com or x.com', 'error');
   
              return;
            }

            const tweetId = extractTweetId(urlInput);
            if (!tweetId) {
                showStatus('Could not extract Tweet ID from URL', 'error');
                return;
       
      }

            try {
                loadBtn.disabled = true;
                loadBtn.textContent = 'Loading...';
                showStatus('Fetching tweet data...', 'info');

                const tweetData = await fetchTweetData(tweetId);
       
          await updateTweetCardContent(tweetData);
                applyCustomizations();
                
                statusMessage.className = 'status-message';
                loadBtn.textContent = 'Generate';
                loadBtn.disabled = false;
            } catch (error) {
                showStatus('Error loading tweet: ' + error.message, 'error');
                loadBtn.textContent = 'Generate';
                loadBtn.disabled = false;
            }
        });
 // ===== DOWNLOAD IMAGE =====
        downloadBtn.addEventListener('click', async () => {
            try {
                downloadBtn.disabled = true;
                downloadBtn.textContent = 'Generating...';

                await new Promise(resolve => setTimeout(resolve, 100));

              
   let bgColor = themeLight.checked ? '#FFFFFF' : '#192734';
                
                if (roundedCorners.checked) {
                    bgColor = null;
                }

                const canvas = 
 await html2canvas(tweetCard, {
                    scale: 3,
                    backgroundColor: bgColor,
                    useCORS: true,
                    allowTaint: false,
              
       logging: false,
                    imageTimeout: 0,
                    removeContainer: true
                });

                const link = document.createElement('a');
                
 const timestamp = new Date().getTime();
                link.download = `tweet-${timestamp}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();

                downloadBtn.textContent = 'Download as PNG';
                downloadBtn.disabled = false;
            } catch (error) {
                showStatus('Error generating image: '.message, 'error');
                downloadBtn.textContent = 'Download as PNG';
                downloadBtn.disabled = false;
            }
        });
 // ===== CUSTOMIZATION LISTENERS =====
        showProfilePic.addEventListener('change', applyCustomizations);
        showLikes.addEventListener('change', applyCustomizations);
        showRetweets.addEventListener('change', applyCustomizations);
        showDate.addEventListener('change', applyCustomizations);
        themeLight.addEventListener('change', () => {
            if (roundedCorners.checked) {
                roundedCorners.checked = false;
            }
            applyTheme();
        });
 themeDark.addEventListener('change', () => {
            if (roundedCorners.checked) {
                roundedCorners.checked = false;
            }
            applyTheme();
        });
 roundedCorners.addEventListener('change', applyTheme);

        // ===== ENTER KEY SUPPORT =====
        tweetUrl.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loadBtn.click();
            }
        });
 // ===== INITIALIZE =====
        applyCustomizations();
        applyTheme();
    </script>

    <script>
    // ===== FOURTHWALL SCROLLBAR FIX =====
    // MODIFIED: Reverted to the original file's load event 
    // to fix the "Content Cut-Off" bug.
    let lastHeight = 0;
    let resizeTimer;

    function sendHeight() {
      const height = document.body.scrollHeight;
      if (height !== lastHeight) {
        lastHeight = height;
        window.parent.postMessage({ frameHeight: height }, '*');
      }
    }

    function scheduleHeightCheck() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(sendHeight, 150);
    }

    window.addEventListener('load', () => {
        setTimeout(sendHeight, 100);
        setTimeout(sendHeight, 500);
        setTimeout(sendHeight, 1000);
    });
    window.addEventListener('resize', () => {
        scheduleHeightCheck();
    });
    // ===== END OF SCROLLBAR FIX =====
    </script>
</body>
</html>
