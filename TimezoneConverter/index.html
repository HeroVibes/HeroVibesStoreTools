<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Global Time Converter</title>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
    <style>
        /* ===== CORE STYLES ===== */
        :root {
            --primary-bg: #191919;
            --secondary-bg: #1F1F1F;
            --hover-color: #323232;
            --outline-color: #323232;
            --accent-color: #87A9FF;
            --primary-text: #D4D4D4;
            --secondary-text: #8C8C8C;
            --radius: 8px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background-color: var(--primary-bg);
            color: var(--primary-text);
            line-height: 1.6;
            padding: 24px 16px;
        }

        /* ===== CONTAINER ===== */
        .time-converter-container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--secondary-bg);
            border-radius: var(--radius);
            border: 1px solid var(--outline-color);
            padding: 24px 16px;
        }

        /* ===== INPUT SECTION ===== */
        .input-section {
            background-color: var(--primary-bg);
            border-radius: var(--radius);
            padding: 24px 16px;
            margin-bottom: 24px;
            border: 1px solid var(--outline-color);
        }

        .input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
            justify-content: center;
        }

        .time-input-container {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: var(--secondary-bg);
            border-radius: var(--radius);
            padding: 12px 16px;
            border: 1px solid var(--outline-color);
        }

        .time-input-container label {
            font-weight: bold;
            color: var(--primary-text);
            font-size: 14px;
        }

        .time-select, .timezone-dropdown {
            background-color: var(--primary-bg);
            color: var(--primary-text);
            border: 1px solid var(--outline-color);
            border-radius: var(--radius);
            padding: 8px 12px;
            font-size: 14px;
            outline: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .time-select {
            width: 65px;
        }

        .ampm-select {
            width: 70px;
        }

        .time-separator {
            font-weight: bold;
            color: var(--secondary-text);
            font-size: 16px;
        }

        .timezone-dropdown {
            min-width: 250px;
        }

        .time-select:hover, .timezone-dropdown:hover {
            background-color: var(--hover-color);
        }

        .time-select:focus, .timezone-dropdown:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(135, 169, 255, 0.2);
        }

        /* ===== SECTION STYLES ===== */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-text);
        }

        /* ===== SEARCH BAR ===== */
        .search-container {
            position: relative;
            flex: 1;
            max-width: 300px;
            min-width: 200px;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px 10px 40px;
            background-color: var(--primary-bg);
            color: var(--primary-text);
            border: 1px solid var(--outline-color);
            border-radius: var(--radius);
            font-size: 12px;
            outline: none;
            transition: all 0.2s ease;
        }

        .search-input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(135, 169, 255, 0.2);
        }

        .search-input::placeholder {
            color: var(--secondary-text);
        }

        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary-text);
            pointer-events: none;
        }

        /* ===== TIMEZONE GRID ===== */
        .timezone-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        /* ===== TIME CARD ===== */
        .time-card {
            position: relative;
            background-color: var(--primary-bg);
            border: 1px solid var(--outline-color);
            border-radius: var(--radius);
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .time-card:hover {
            background-color: var(--hover-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .time-card.selected {
            border-color: var(--accent-color);
        }

        .time-display {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-text);
            margin-bottom: 8px;
        }

        .timezone-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .timezone-abbr {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-color);
        }

        .timezone-name {
            font-size: 12px;
            color: var(--secondary-text);
        }

        .remove-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: var(--secondary-text);
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
            line-height: 1;
            opacity: 0;
            transition: all 0.2s ease;
        }

        .time-card:hover .remove-btn {
            opacity: 1;
        }

        .remove-btn:hover {
            color: #ff6b6b;
        }

        /* ===== BUTTON ===== */
        .btn {
            position: relative;
            padding: 10px 16px;
            border-radius: var(--radius);
            background: var(--secondary-bg);
            color: var(--primary-text);
            border: 1px solid rgba(255,255,255,0.06);
            cursor: pointer;
            overflow: hidden;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 75%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            transform: skewX(-25deg);
            transition: left 0.7s ease-in-out;
        }

        .btn:hover::before {
            left: 125%;
        }

        .btn:hover {
            background-color: var(--hover-color);
        }

        .btn:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(135,169,255,0.12);
        }

        .see-more-btn {
            width: 100%;
            margin-top: 12px;
        }

        /* ===== UTILITY ===== */
        .separator {
            border: none;
            border-top: 1px solid var(--outline-color);
            margin: 24px 0;
        }

        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: var(--secondary-text);
            font-size: 14px;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .timezone-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: stretch;
            }

            .search-container {
                max-width: 100%;
            }

            .input-row {
                flex-direction: column;
            }

            .time-input-container {
                width: 100%;
                justify-content: center;
            }

            .timezone-dropdown {
                width: 100%;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 16px 8px;
            }

            .time-converter-container {
                padding: 16px 12px;
            }

            .time-display {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="time-converter-container">
        <!-- INPUT SECTION -->
        <div class="input-section">
            <div class="input-row">
                <div class="time-input-container">
                    <label for="input-hour">Time:</label>
                    <select id="input-hour" class="time-select"></select>
                    <span class="time-separator">:</span>
                    <select id="input-minute" class="time-select"></select>
                    <select id="input-ampm" class="time-select ampm-select"></select>
                </div>

                <div class="time-input-container">
                    <label for="from-timezone">From:</label>
                    <select class="timezone-dropdown" id="from-timezone"></select>
                </div>
            </div>
        </div>

        <!-- ACTION BUTTONS -->
        <div class="action-buttons">
            <button class="btn" id="share-btn">üìã Copy Share Link</button>
            <button class="btn" id="save-btn">üíæ Save Preferences</button>
            <button class="btn" id="reset-btn">üîÑ Reset to Defaults</button>
        </div>

        <hr class="separator">

        <!-- SELECTED TIMEZONES -->
        <div class="section-header">
            <h2 class="section-title">Your Timezones</h2>
        </div>
        <div class="timezone-grid" id="selected-grid"></div>

        <hr class="separator">

        <!-- ALL TIMEZONES -->
        <div class="section-header">
            <h2 class="section-title">Add Timezones</h2>
            <div class="search-container">
                <span class="search-icon">üîç</span>
                <input type="text" id="timezone-search" class="search-input" placeholder="Search by city or timezone...">
            </div>
        </div>
        <div class="timezone-grid" id="all-grid"></div>
        <button class="btn see-more-btn" id="see-more-btn" style="display: none;">See More Timezones</button>
    </div>

    <script>
        const { DateTime } = luxon;

        // ===== TIMEZONE DATA =====
        const POPULAR_TIMEZONES = [
            'Etc/UTC',
            'Europe/London',
            'America/New_York',
            'America/Los_Angeles',
            'America/Chicago',
            'Asia/Tokyo',
            'Asia/Shanghai',
            'Asia/Kolkata',
            'Australia/Sydney',
            'Europe/Paris',
            'America/Toronto',
            'Asia/Dubai'
        ];

        // Comprehensive location aliases - maps search terms to timezone IDs
        const LOCATION_ALIASES = {
            // UTC/GMT
            'utc': ['Etc/UTC'],
            'universal': ['Etc/UTC'],
            'gmt': ['Europe/London'],
            
            // United Kingdom
            'london': ['Europe/London'],
            'uk': ['Europe/London'],
            'united kingdom': ['Europe/London'],
            'england': ['Europe/London'],
            'britain': ['Europe/London'],
            'great britain': ['Europe/London'],
            'manchester': ['Europe/London'],
            'birmingham': ['Europe/London'],
            'liverpool': ['Europe/London'],
            'edinburgh': ['Europe/London'],
            'scotland': ['Europe/London'],
            'glasgow': ['Europe/London'],
            'cardiff': ['Europe/London'],
            'wales': ['Europe/London'],
            'belfast': ['Europe/London'],
            'dublin': ['Europe/Dublin'],
            'ireland': ['Europe/Dublin'],
            
            // United States - East Coast
            'new york': ['America/New_York'],
            'nyc': ['America/New_York'],
            'ny': ['America/New_York'],
            'new york city': ['America/New_York'],
            'manhattan': ['America/New_York'],
            'brooklyn': ['America/New_York'],
            'boston': ['America/New_York'],
            'philadelphia': ['America/New_York'],
            'philly': ['America/New_York'],
            'washington': ['America/New_York'],
            'dc': ['America/New_York'],
            'washington dc': ['America/New_York'],
            'miami': ['America/New_York'],
            'orlando': ['America/New_York'],
            'atlanta': ['America/New_York'],
            'detroit': ['America/New_York'],
            'pittsburgh': ['America/New_York'],
            'baltimore': ['America/New_York'],
            
            // United States - West Coast
            'los angeles': ['America/Los_Angeles'],
            'la': ['America/Los_Angeles'],
            'california': ['America/Los_Angeles'],
            'san francisco': ['America/Los_Angeles'],
            'sf': ['America/Los_Angeles'],
            'san diego': ['America/Los_Angeles'],
            'san jose': ['America/Los_Angeles'],
            'sacramento': ['America/Los_Angeles'],
            'oakland': ['America/Los_Angeles'],
            'seattle': ['America/Los_Angeles'],
            'portland': ['America/Los_Angeles'],
            'las vegas': ['America/Los_Angeles'],
            'vegas': ['America/Los_Angeles'],
            
            // United States - Central
            'chicago': ['America/Chicago'],
            'dallas': ['America/Chicago'],
            'houston': ['America/Chicago'],
            'austin': ['America/Chicago'],
            'san antonio': ['America/Chicago'],
            'nashville': ['America/Chicago'],
            'memphis': ['America/Chicago'],
            'new orleans': ['America/Chicago'],
            'milwaukee': ['America/Chicago'],
            'minneapolis': ['America/Chicago'],
            'st louis': ['America/Chicago'],
            'kansas city': ['America/Chicago'],
            
            // United States - Mountain
            'denver': ['America/Denver'],
            'phoenix': ['America/Phoenix'],
            'salt lake city': ['America/Denver'],
            'albuquerque': ['America/Denver'],
            
            // United States - Other
            'anchorage': ['America/Anchorage'],
            'alaska': ['America/Anchorage'],
            'honolulu': ['Pacific/Honolulu'],
            'hawaii': ['Pacific/Honolulu'],
            
            // Canada
            'toronto': ['America/Toronto'],
            'montreal': ['America/Toronto'],
            'ottawa': ['America/Toronto'],
            'vancouver': ['America/Vancouver'],
            'calgary': ['America/Edmonton'],
            'edmonton': ['America/Edmonton'],
            'winnipeg': ['America/Winnipeg'],
            'quebec': ['America/Toronto'],
            'canada': ['America/Toronto'],
            
            // Europe - Major Cities
            'paris': ['Europe/Paris'],
            'france': ['Europe/Paris'],
            'berlin': ['Europe/Berlin'],
            'germany': ['Europe/Berlin'],
            'munich': ['Europe/Berlin'],
            'frankfurt': ['Europe/Berlin'],
            'rome': ['Europe/Rome'],
            'italy': ['Europe/Rome'],
            'milan': ['Europe/Rome'],
            'madrid': ['Europe/Madrid'],
            'spain': ['Europe/Madrid'],
            'barcelona': ['Europe/Madrid'],
            'amsterdam': ['Europe/Amsterdam'],
            'netherlands': ['Europe/Amsterdam'],
            'brussels': ['Europe/Brussels'],
            'belgium': ['Europe/Brussels'],
            'vienna': ['Europe/Vienna'],
            'austria': ['Europe/Vienna'],
            'zurich': ['Europe/Zurich'],
            'switzerland': ['Europe/Zurich'],
            'geneva': ['Europe/Zurich'],
            'stockholm': ['Europe/Stockholm'],
            'sweden': ['Europe/Stockholm'],
            'oslo': ['Europe/Oslo'],
            'norway': ['Europe/Oslo'],
            'copenhagen': ['Europe/Copenhagen'],
            'denmark': ['Europe/Copenhagen'],
            'helsinki': ['Europe/Helsinki'],
            'finland': ['Europe/Helsinki'],
            'warsaw': ['Europe/Warsaw'],
            'poland': ['Europe/Warsaw'],
            'prague': ['Europe/Prague'],
            'czech': ['Europe/Prague'],
            'budapest': ['Europe/Budapest'],
            'hungary': ['Europe/Budapest'],
            'athens': ['Europe/Athens'],
            'greece': ['Europe/Athens'],
            'lisbon': ['Europe/Lisbon'],
            'portugal': ['Europe/Lisbon'],
            'moscow': ['Europe/Moscow'],
            'russia': ['Europe/Moscow'],
            'istanbul': ['Europe/Istanbul'],
            'turkey': ['Europe/Istanbul'],
            
            // Asia - Major Cities
            'tokyo': ['Asia/Tokyo'],
            'japan': ['Asia/Tokyo'],
            'osaka': ['Asia/Tokyo'],
            'beijing': ['Asia/Shanghai'],
            'shanghai': ['Asia/Shanghai'],
            'china': ['Asia/Shanghai'],
            'hong kong': ['Asia/Hong_Kong'],
            'hk': ['Asia/Hong_Kong'],
            'singapore': ['Asia/Singapore'],
            'seoul': ['Asia/Seoul'],
            'korea': ['Asia/Seoul'],
            'south korea': ['Asia/Seoul'],
            'taipei': ['Asia/Taipei'],
            'taiwan': ['Asia/Taipei'],
            'bangkok': ['Asia/Bangkok'],
            'thailand': ['Asia/Bangkok'],
            'manila': ['Asia/Manila'],
            'philippines': ['Asia/Manila'],
            'jakarta': ['Asia/Jakarta'],
            'indonesia': ['Asia/Jakarta'],
            'kuala lumpur': ['Asia/Kuala_Lumpur'],
            'malaysia': ['Asia/Kuala_Lumpur'],
            'hanoi': ['Asia/Ho_Chi_Minh'],
            'vietnam': ['Asia/Ho_Chi_Minh'],
            'dubai': ['Asia/Dubai'],
            'uae': ['Asia/Dubai'],
            'abu dhabi': ['Asia/Dubai'],
            'mumbai': ['Asia/Kolkata'],
            'india': ['Asia/Kolkata'],
            'delhi': ['Asia/Kolkata'],
            'bangalore': ['Asia/Kolkata'],
            'kolkata': ['Asia/Kolkata'],
            'chennai': ['Asia/Kolkata'],
            
            // Australia & New Zealand
            'sydney': ['Australia/Sydney'],
            'melbourne': ['Australia/Melbourne'],
            'brisbane': ['Australia/Brisbane'],
            'perth': ['Australia/Perth'],
            'adelaide': ['Australia/Adelaide'],
            'australia': ['Australia/Sydney', 'Australia/Melbourne', 'Australia/Brisbane', 'Australia/Perth', 'Australia/Adelaide'],
            'auckland': ['Pacific/Auckland'],
            'new zealand': ['Pacific/Auckland'],
            'wellington': ['Pacific/Auckland'],
            
            // Middle East
            'riyadh': ['Asia/Riyadh'],
            'saudi arabia': ['Asia/Riyadh'],
            'doha': ['Asia/Qatar'],
            'qatar': ['Asia/Qatar'],
            'kuwait': ['Asia/Kuwait'],
            'tel aviv': ['Asia/Jerusalem'],
            'jerusalem': ['Asia/Jerusalem'],
            'israel': ['Asia/Jerusalem'],
            
            // South America
            'sao paulo': ['America/Sao_Paulo'],
            'brazil': ['America/Sao_Paulo'],
            'rio': ['America/Sao_Paulo'],
            'buenos aires': ['America/Argentina/Buenos_Aires'],
            'argentina': ['America/Argentina/Buenos_Aires'],
            'santiago': ['America/Santiago'],
            'chile': ['America/Santiago'],
            'bogota': ['America/Bogota'],
            'colombia': ['America/Bogota'],
            'lima': ['America/Lima'],
            'peru': ['America/Lima'],
            'mexico city': ['America/Mexico_City'],
            'mexico': ['America/Mexico_City'],
            
            // Africa
            'cairo': ['Africa/Cairo'],
            'egypt': ['Africa/Cairo'],
            'johannesburg': ['Africa/Johannesburg'],
            'south africa': ['Africa/Johannesburg'],
            'cape town': ['Africa/Johannesburg'],
            'lagos': ['Africa/Lagos'],
            'nigeria': ['Africa/Lagos'],
            'nairobi': ['Africa/Nairobi'],
            'kenya': ['Africa/Nairobi']
        };

        // Timezone abbreviations map
        const TIMEZONE_ABBR = {
            'Etc/UTC': { standard: 'UTC', daylight: 'UTC' },
            'Etc/GMT': { standard: 'GMT', daylight: 'GMT' },
            
            // UK & Ireland
            'Europe/London': { standard: 'GMT', daylight: 'BST' },
            'Europe/Dublin': { standard: 'GMT', daylight: 'IST' },
            
            // Europe - Central
            'Europe/Paris': { standard: 'CET', daylight: 'CEST' },
            'Europe/Berlin': { standard: 'CET', daylight: 'CEST' },
            'Europe/Rome': { standard: 'CET', daylight: 'CEST' },
            'Europe/Madrid': { standard: 'CET', daylight: 'CEST' },
            'Europe/Amsterdam': { standard: 'CET', daylight: 'CEST' },
            'Europe/Brussels': { standard: 'CET', daylight: 'CEST' },
            'Europe/Vienna': { standard: 'CET', daylight: 'CEST' },
            'Europe/Zurich': { standard: 'CET', daylight: 'CEST' },
            'Europe/Warsaw': { standard: 'CET', daylight: 'CEST' },
            'Europe/Prague': { standard: 'CET', daylight: 'CEST' },
            'Europe/Budapest': { standard: 'CET', daylight: 'CEST' },
            
            // Europe - Eastern
            'Europe/Athens': { standard: 'EET', daylight: 'EEST' },
            'Europe/Bucharest': { standard: 'EET', daylight: 'EEST' },
            'Europe/Helsinki': { standard: 'EET', daylight: 'EEST' },
            'Europe/Istanbul': { standard: 'TRT', daylight: 'TRT' },
            'Europe/Moscow': { standard: 'MSK', daylight: 'MSK' },
            
            // Europe - Northern
            'Europe/Stockholm': { standard: 'CET', daylight: 'CEST' },
            'Europe/Oslo': { standard: 'CET', daylight: 'CEST' },
            'Europe/Copenhagen': { standard: 'CET', daylight: 'CEST' },
            
            // Europe - Western
            'Europe/Lisbon': { standard: 'WET', daylight: 'WEST' },
            
            // North America - US Eastern
            'America/New_York': { standard: 'EST', daylight: 'EDT' },
            'America/Toronto': { standard: 'EST', daylight: 'EDT' },
            
            // North America - US Central
            'America/Chicago': { standard: 'CST', daylight: 'CDT' },
            'America/Mexico_City': { standard: 'CST', daylight: 'CDT' },
            
            // North America - US Mountain
            'America/Denver': { standard: 'MST', daylight: 'MDT' },
            'America/Phoenix': { standard: 'MST', daylight: 'MST' },
            
            // North America - US Pacific
            'America/Los_Angeles': { standard: 'PST', daylight: 'PDT' },
            'America/Vancouver': { standard: 'PST', daylight: 'PDT' },
            
            // North America - Alaska & Hawaii
            'America/Anchorage': { standard: 'AKST', daylight: 'AKDT' },
            'Pacific/Honolulu': { standard: 'HST', daylight: 'HST' },
            
            // Asia - East
            'Asia/Tokyo': { standard: 'JST', daylight: 'JST' },
            'Asia/Seoul': { standard: 'KST', daylight: 'KST' },
            'Asia/Shanghai': { standard: 'CST', daylight: 'CST' },
            'Asia/Hong_Kong': { standard: 'HKT', daylight: 'HKT' },
            'Asia/Taipei': { standard: 'CST', daylight: 'CST' },
            
            // Asia - Southeast
            'Asia/Singapore': { standard: 'SGT', daylight: 'SGT' },
            'Asia/Bangkok': { standard: 'ICT', daylight: 'ICT' },
            'Asia/Jakarta': { standard: 'WIB', daylight: 'WIB' },
            'Asia/Manila': { standard: 'PST', daylight: 'PST' },
            'Asia/Kuala_Lumpur': { standard: 'MYT', daylight: 'MYT' },
            'Asia/Ho_Chi_Minh': { standard: 'ICT', daylight: 'ICT' },
            
            // Asia - South
            'Asia/Kolkata': { standard: 'IST', daylight: 'IST' },
            'Asia/Dhaka': { standard: 'BST', daylight: 'BST' },
            'Asia/Karachi': { standard: 'PKT', daylight: 'PKT' },
            
            // Asia - Middle East
            'Asia/Dubai': { standard: 'GST', daylight: 'GST' },
            'Asia/Riyadh': { standard: 'AST', daylight: 'AST' },
            'Asia/Jerusalem': { standard: 'IST', daylight: 'IDT' },
            'Asia/Tehran': { standard: 'IRST', daylight: 'IRDT' },
            'Asia/Qatar': { standard: 'AST', daylight: 'AST' },
            'Asia/Kuwait': { standard: 'AST', daylight: 'AST' },
            
            // Australia
            'Australia/Sydney': { standard: 'AEST', daylight: 'AEDT' },
            'Australia/Melbourne': { standard: 'AEST', daylight: 'AEDT' },
            'Australia/Brisbane': { standard: 'AEST', daylight: 'AEST' },
            'Australia/Perth': { standard: 'AWST', daylight: 'AWST' },
            'Australia/Adelaide': { standard: 'ACST', daylight: 'ACDT' },
            
            // New Zealand
            'Pacific/Auckland': { standard: 'NZST', daylight: 'NZDT' },
            
            // South America
            'America/Sao_Paulo': { standard: 'BRT', daylight: 'BRST' },
            'America/Argentina/Buenos_Aires': { standard: 'ART', daylight: 'ART' },
            'America/Santiago': { standard: 'CLT', daylight: 'CLST' },
            'America/Bogota': { standard: 'COT', daylight: 'COT' },
            'America/Lima': { standard: 'PET', daylight: 'PET' },
            
            // Africa
            'Africa/Cairo': { standard: 'EET', daylight: 'EEST' },
            'Africa/Johannesburg': { standard: 'SAST', daylight: 'SAST' },
            'Africa/Lagos': { standard: 'WAT', daylight: 'WAT' },
            'Africa/Nairobi': { standard: 'EAT', daylight: 'EAT' },
            
            // Other North America
            'America/Edmonton': { standard: 'MST', daylight: 'MDT' },
            'America/Winnipeg': { standard: 'CST', daylight: 'CDT' }
        };

        // ===== STATE =====
        let selectedTimezones = new Set(POPULAR_TIMEZONES);
        let allTimezones = [];
        let showAllTimezones = false;
        const INITIAL_DISPLAY_LIMIT = 20;

        // ===== DOM ELEMENTS =====
        const inputHour = document.getElementById('input-hour');
        const inputMinute = document.getElementById('input-minute');
        const inputAmPm = document.getElementById('input-ampm');
        const fromSelect = document.getElementById('from-timezone');
        const selectedGrid = document.getElementById('selected-grid');
        const allGrid = document.getElementById('all-grid');
        const searchInput = document.getElementById('timezone-search');
        const shareBtn = document.getElementById('share-btn');
        const saveBtn = document.getElementById('save-btn');
        const resetBtn = document.getElementById('reset-btn');
        const seeMoreBtn = document.getElementById('see-more-btn');

        // ===== INITIALIZATION =====
        function init() {
            // Get all unique timezones
            const now = DateTime.now();
            const rawTimezones = Intl.supportedValuesOf('timeZone');
            const uniqueMap = new Map();

            rawTimezones.forEach(tz => {
                try {
                    const dt = now.setZone(tz);
                    if (dt.isValid) {
                        const key = `${dt.offset}_${dt.zoneName}`;
                        if (!uniqueMap.has(key)) {
                            uniqueMap.set(key, tz);
                        }
                    }
                } catch (e) {}
            });

            allTimezones = Array.from(uniqueMap.values()).sort();

            // Populate time selectors
            for (let i = 1; i <= 12; i++) {
                const opt = document.createElement('option');
                opt.value = String(i).padStart(2, '0');
                opt.textContent = String(i).padStart(2, '0');
                inputHour.appendChild(opt);
            }

            for (let i = 0; i < 60; i += 5) {
                const opt = document.createElement('option');
                opt.value = String(i).padStart(2, '0');
                opt.textContent = String(i).padStart(2, '0');
                inputMinute.appendChild(opt);
            }

            ['AM', 'PM'].forEach(period => {
                const opt = document.createElement('option');
                opt.value = period;
                opt.textContent = period;
                inputAmPm.appendChild(opt);
            });

            // Populate from timezone dropdown
            populateFromDropdown();

            // Set current time
            setCurrentTime();

            // Load from URL or localStorage
            loadState();

            // Event listeners
            inputHour.addEventListener('change', render);
            inputMinute.addEventListener('change', render);
            inputAmPm.addEventListener('change', render);
            fromSelect.addEventListener('change', render);
            searchInput.addEventListener('input', () => {
                showAllTimezones = false;
                render();
            });
            shareBtn.addEventListener('click', shareLink);
            saveBtn.addEventListener('click', savePreferences);
            resetBtn.addEventListener('click', resetToDefaults);
            seeMoreBtn.addEventListener('click', () => {
                showAllTimezones = true;
                render();
            });

            // Initial render
            render();
        }

        function populateFromDropdown() {
            fromSelect.innerHTML = '';
            
            // Add popular timezones
            POPULAR_TIMEZONES.forEach(tz => {
                const opt = document.createElement('option');
                opt.value = tz;
                opt.textContent = getDisplayName(tz, DateTime.now());
                fromSelect.appendChild(opt);
            });

            // Add separator
            const sep = document.createElement('option');
            sep.disabled = true;
            sep.textContent = '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ';
            fromSelect.appendChild(sep);

            // Add all other timezones
            allTimezones.filter(tz => !POPULAR_TIMEZONES.includes(tz)).forEach(tz => {
                const opt = document.createElement('option');
                opt.value = tz;
                opt.textContent = getDisplayName(tz, DateTime.now());
                fromSelect.appendChild(opt);
            });
        }

        function setCurrentTime() {
            const now = DateTime.now();
            let hour = now.hour;
            const ampm = hour >= 12 ? 'PM' : 'AM';
            hour = hour % 12 || 12;

            inputHour.value = String(hour).padStart(2, '0');
            inputMinute.value = String(Math.floor(now.minute / 5) * 5).padStart(2, '0');
            inputAmPm.value = ampm;
        }

        // ===== STATE MANAGEMENT =====
        function loadState() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // Load from URL
            if (urlParams.has('t')) {
                const time = urlParams.get('t');
                const [hourMin, ampm] = time.split(' ');
                const [hour, minute] = hourMin.split(':');
                inputHour.value = hour;
                inputMinute.value = minute;
                inputAmPm.value = ampm;
            }

            if (urlParams.has('from')) {
                const fromTz = decodeURIComponent(urlParams.get('from'));
                if (allTimezones.includes(fromTz)) {
                    fromSelect.value = fromTz;
                }
            }

            if (urlParams.has('zones')) {
                const zones = decodeURIComponent(urlParams.get('zones')).split(',');
                selectedTimezones = new Set(zones.filter(z => allTimezones.includes(z)));
                if (selectedTimezones.size === 0) {
                    selectedTimezones = new Set(POPULAR_TIMEZONES);
                }
            } else {
                // Try localStorage
                const saved = localStorage.getItem('timezone_preferences');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        if (data.zones && Array.isArray(data.zones)) {
                            selectedTimezones = new Set(data.zones.filter(z => allTimezones.includes(z)));
                        }
                        if (data.from && allTimezones.includes(data.from)) {
                            fromSelect.value = data.from;
                        }
                    } catch (e) {}
                }
            }
        }

        function savePreferences() {
            const data = {
                zones: Array.from(selectedTimezones),
                from: fromSelect.value
            };
            localStorage.setItem('timezone_preferences', JSON.stringify(data));
            showNotification('‚úÖ Preferences saved!');
        }

        function resetToDefaults() {
            selectedTimezones = new Set(POPULAR_TIMEZONES);
            fromSelect.value = 'Etc/UTC';
            setCurrentTime();
            showAllTimezones = false;
            localStorage.removeItem('timezone_preferences');
            window.history.replaceState({}, '', window.location.pathname);
            render();
            showNotification('üîÑ Reset to defaults');
        }

        function shareLink() {
            const time = `${inputHour.value}:${inputMinute.value} ${inputAmPm.value}`;
            const from = encodeURIComponent(fromSelect.value);
            const zones = encodeURIComponent(Array.from(selectedTimezones).join(','));
            
            const url = `${window.location.origin}${window.location.pathname}?t=${time}&from=${from}&zones=${zones}`;
            
            navigator.clipboard.writeText(url).then(() => {
                showNotification('üìã Link copied to clipboard!');
            }).catch(() => {
                showNotification('‚ùå Failed to copy link');
            });
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--accent-color);
                color: var(--primary-bg);
                padding: 12px 20px;
                border-radius: var(--radius);
                font-weight: bold;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2500);
        }

        // ===== RENDERING =====
        function render() {
            const baseTime = getBaseDateTime();
            renderSelectedTimezones(baseTime);
            renderAllTimezones(baseTime);
        }

        function getBaseDateTime() {
            let hour = parseInt(inputHour.value);
            const minute = parseInt(inputMinute.value);
            const ampm = inputAmPm.value;

            if (ampm === 'PM' && hour !== 12) hour += 12;
            if (ampm === 'AM' && hour === 12) hour = 0;

            return DateTime.now().setZone(fromSelect.value).set({
                hour,
                minute,
                second: 0,
                millisecond: 0
            });
        }

        function renderSelectedTimezones(baseTime) {
            selectedGrid.innerHTML = '';

            const sorted = Array.from(selectedTimezones).sort((a, b) => {
                const aIndex = POPULAR_TIMEZONES.indexOf(a);
                const bIndex = POPULAR_TIMEZONES.indexOf(b);
                if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;
                if (aIndex !== -1) return -1;
                if (bIndex !== -1) return 1;
                return a.localeCompare(b);
            });

            sorted.forEach(tz => {
                const card = createTimeCard(tz, baseTime, true);
                selectedGrid.appendChild(card);
            });
        }

        function renderAllTimezones(baseTime) {
            allGrid.innerHTML = '';
            const searchTerm = searchInput.value.toLowerCase().trim();

            let matchedTimezones = new Set();

            if (searchTerm) {
                // First, check location aliases
                for (const [alias, timezones] of Object.entries(LOCATION_ALIASES)) {
                    if (alias.includes(searchTerm)) {
                        timezones.forEach(tz => matchedTimezones.add(tz));
                    }
                }

                // Then check timezone IDs and display names
                allTimezones.forEach(tz => {
                    if (selectedTimezones.has(tz)) return;
                    
                    const displayName = getDisplayName(tz, baseTime).toLowerCase();
                    const friendlyName = getFriendlyName(tz).toLowerCase();
                    const tzLower = tz.toLowerCase();
                    
                    if (tzLower.includes(searchTerm) || 
                        displayName.includes(searchTerm) || 
                        friendlyName.includes(searchTerm)) {
                        matchedTimezones.add(tz);
                    }
                });

                // Convert to array and remove already selected
                var filtered = Array.from(matchedTimezones).filter(tz => !selectedTimezones.has(tz));
            } else {
                // No search term - show all unselected timezones
                var filtered = allTimezones.filter(tz => !selectedTimezones.has(tz));
            }

            if (filtered.length === 0) {
                allGrid.innerHTML = '<div class="no-results">No matching timezones found. Try searching for a city name like "London", "New York", or "Tokyo".</div>';
                seeMoreBtn.style.display = 'none';
                return;
            }

            filtered.sort((a, b) => getDisplayName(a, baseTime).localeCompare(getDisplayName(b, baseTime)));

            // Determine how many to show
            const limit = (showAllTimezones || searchTerm) ? filtered.length : INITIAL_DISPLAY_LIMIT;
            const toDisplay = filtered.slice(0, limit);

            toDisplay.forEach(tz => {
                const card = createTimeCard(tz, baseTime, false);
                allGrid.appendChild(card);
            });

            // Show "See More" button if there are more results
            if (!showAllTimezones && !searchTerm && filtered.length > INITIAL_DISPLAY_LIMIT) {
                seeMoreBtn.style.display = 'block';
                seeMoreBtn.textContent = `See More Timezones (${filtered.length - INITIAL_DISPLAY_LIMIT} more)`;
            } else {
                seeMoreBtn.style.display = 'none';
            }
        }

        function createTimeCard(timezone, baseTime, isSelected) {
            const card = document.createElement('div');
            card.className = `time-card ${isSelected ? 'selected' : ''}`;
            card.dataset.timezone = timezone;

            const convertedTime = baseTime.setZone(timezone);
            const timeStr = convertedTime.toFormat('hh:mm a');
            const abbr = getTimezoneAbbr(timezone, convertedTime);
            const displayName = getFriendlyName(timezone);

            card.innerHTML = `
                <div class="time-display">${timeStr}</div>
                <div class="timezone-info">
                    <div class="timezone-abbr">${abbr}</div>
                    <div class="timezone-name">${displayName}</div>
                </div>
                ${isSelected ? '<button class="remove-btn">‚úï</button>' : ''}
            `;

            if (isSelected) {
                card.querySelector('.remove-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectedTimezones.delete(timezone);
                    render();
                });
            } else {
                card.addEventListener('click', () => {
                    selectedTimezones.add(timezone);
                    showAllTimezones = false;
                    render();
                });
            }

            return card;
        }

        // ===== HELPERS =====
        function getDisplayName(timezone, dateTime) {
            const dt = dateTime.setZone(timezone);
            const abbr = getTimezoneAbbr(timezone, dt);
            const friendly = getFriendlyName(timezone);
            return `${friendly} (${abbr})`;
        }

        function getFriendlyName(timezone) {
            const parts = timezone.split('/');
            return parts[parts.length - 1].replace(/_/g, ' ');
        }

        function getTimezoneAbbr(timezone, dateTime) {
            const dt = dateTime.setZone(timezone);
            
            // Check if we have a custom abbreviation
            if (TIMEZONE_ABBR[timezone]) {
                const abbrs = TIMEZONE_ABBR[timezone];
                return dt.isInDST ? abbrs.daylight : abbrs.standard;
            }

            // Fallback to offset-based
            const offset = dt.offset;
            const offsetHours = Math.floor(Math.abs(offset) / 60);
            const offsetMinutes = Math.abs(offset) % 60;
            const sign = offset >= 0 ? '+' : '-';
            
            return `UTC${sign}${String(offsetHours).padStart(2, '0')}${offsetMinutes > 0 ? ':' + String(offsetMinutes).padStart(2, '0') : ''}`;
        }

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // ===== START APP =====
        init();
    </script>

    <script>
        // ===== FOURTHWALL SCROLLBAR FIX =====
        function sendHeight() {
            var height = document.body.scrollHeight;
            window.parent.postMessage({ frameHeight: height }, '*');
        }

        window.onload = sendHeight;
        window.onresize = sendHeight;
    </script>
</body>
</html>
