<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stream Deck Bulk Icon Maker</title>
  <style>
    :root {
      --bg: #191919;
      --card-bg: #1F1F1F;
      --hover: #323232;
      --outline: #323232;
      --accent: #87A9FF;
      --text-primary: #D4D4D4;
      --text-secondary: #8C8C8C;
      --radius: 8px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg);
      color: var(--text-primary);
      font-family: sans-serif;
      padding: 24px 16px;
    }

    /* ===== MAIN CONTAINER ===== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* ===== SEARCH & CONTROLS SECTION ===== */
    .controls-section {
      background: var(--card-bg);
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      padding: 24px 16px;
      margin-bottom: 16px;
    }

    .search-wrapper {
      position: relative;
      margin-bottom: 16px;
    }

    .search-input {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      color: var(--text-primary);
      padding: 12px 16px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
    }

    .search-input:focus {
      border-color: var(--accent);
    }

    .search-input::placeholder {
      color: var(--text-secondary);
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .control-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .control-label {
      font-size: 12px;
      color: var(--text-secondary);
      white-space: nowrap;
    }

    .size-input {
      width: 70px;
      background: var(--bg);
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      color: var(--text-primary);
      padding: 8px 12px;
      font-size: 12px;
      text-align: center;
    }

    .color-input {
      width: 50px;
      height: 36px;
      background: var(--bg);
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      cursor: pointer;
    }

    /* ===== SELECTION INFO BAR ===== */
    .selection-bar {
      background: var(--card-bg);
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      padding: 12px 16px;
      margin-bottom: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }

    .selection-info {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .selection-count {
      color: var(--accent);
      font-weight: bold;
    }

    /* ===== ICON GRID ===== */
    .icon-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .icon-card {
      background: var(--card-bg);
      border: 2px solid var(--outline);
      border-radius: var(--radius);
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .icon-card:hover {
      background: var(--hover);
      transform: translateY(-2px);
    }

    .icon-card.selected {
      border-color: var(--accent);
      background: var(--hover);
    }

    .icon-card.selected::after {
      content: 'âœ“';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 20px;
      height: 20px;
      background: var(--accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: var(--bg);
      font-weight: bold;
    }

    .icon-preview {
      width: 48px;
      height: 48px;
      filter: brightness(0) invert(1);
    }

    .icon-name {
      font-size: 11px;
      color: var(--text-secondary);
      text-align: center;
      word-break: break-word;
      line-height: 1.3;
    }

    /* ===== BUTTONS ===== */
    .btn {
      position: relative;
      padding: 10px 16px;
      border-radius: var(--radius);
      background: var(--card-bg);
      color: var(--text-primary);
      border: 1px solid rgba(255,255,255,0.06);
      cursor: pointer;
      overflow: hidden;
      font-size: 14px;
      font-family: sans-serif;
      transition: all 0.2s;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 75%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
      transform: skewX(-25deg);
      transition: left 0.7s ease-in-out;
    }

    .btn:hover::before {
      left: 125%;
    }

    .btn:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(135,169,255,0.12);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: var(--accent);
      color: var(--bg);
      font-weight: bold;
    }

    .btn-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* ===== EMPTY STATE ===== */
    .empty-state {
      text-align: center;
      padding: 48px 16px;
      color: var(--text-secondary);
      font-size: 14px;
    }

    /* ===== MOBILE OPTIMIZATION ===== */
    @media (max-width: 640px) {
      body {
        padding: 16px 12px;
      }

      .icon-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 8px;
      }

      .controls-section {
        padding: 16px 12px;
      }

      .controls-row {
        flex-direction: column;
        align-items: stretch;
      }

      .control-group {
        justify-content: space-between;
      }

      .selection-bar {
        flex-direction: column;
        align-items: stretch;
      }

      .btn-group {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }
    }

    @media (max-width: 400px) {
      .icon-grid {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      }

      .icon-preview {
        width: 36px;
        height: 36px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ===== SEARCH & CONTROLS ===== -->
    <div class="controls-section">
      <div class="search-wrapper">
        <input 
          type="text" 
          id="search-input" 
          class="search-input" 
          placeholder="Search icons by name or keyword..."
        >
      </div>
      <div class="controls-row">
        <div class="control-group">
          <label class="control-label" for="icon-size">Size (px):</label>
          <input type="number" id="icon-size" class="size-input" value="512" min="64" max="2048" step="64">
        </div>
        <div class="control-group">
          <label class="control-label" for="bg-color">Background:</label>
          <input type="color" id="bg-color" class="color-input" value="#000000">
        </div>
        <div class="control-group">
          <label class="control-label" for="icon-color">Icon Color:</label>
          <input type="color" id="icon-color" class="color-input" value="#ffffff">
        </div>
      </div>
    </div>

    <!-- ===== SELECTION BAR ===== -->
    <div class="selection-bar">
      <div class="selection-info">
        <span class="selection-count" id="selection-count">0</span> icons selected
      </div>
      <div class="btn-group">
        <button class="btn" id="select-all-btn">Select All</button>
        <button class="btn" id="clear-selection-btn">Clear Selection</button>
        <button class="btn btn-primary" id="download-btn" disabled>Download Selected</button>
      </div>
    </div>

    <!-- ===== ICON GRID ===== -->
    <div id="icon-grid" class="icon-grid"></div>

    <!-- ===== EMPTY STATE ===== -->
    <div id="empty-state" class="empty-state" style="display: none;">
      No icons found matching your search.
    </div>
  </div>

  <script>
    // ===== ICON DATABASE =====
    const icons = [
      { name: 'Adobe Acrobat', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/adobe-acrobat.svg', keywords: ['adobe', 'acrobat', 'pdf', 'document', 'reader'] },
      { name: 'Adobe Illustrator', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/adobe-illustrator.svg', keywords: ['adobe', 'illustrator', 'vector', 'design', 'graphics', 'ai'] },
      { name: 'Adobe Lightroom', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/adobe-lightroom.svg', keywords: ['adobe', 'lightroom', 'photo', 'editing', 'photography', 'lr'] },
      { name: 'Adobe Photoshop', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/adobe-photoshop.svg', keywords: ['adobe', 'photoshop', 'photo', 'editing', 'graphics', 'ps'] },
      { name: 'Adobe Premiere Pro', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/adobe-premiere-pro.svg', keywords: ['adobe', 'premiere', 'video', 'editing', 'film', 'pr'] },
      { name: 'Amazon', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/amazon.svg', keywords: ['amazon', 'shopping', 'ecommerce', 'online', 'store'] },
      { name: 'Arrow Down', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/arrow-down.svg', keywords: ['arrow', 'down', 'direction', 'navigate', 'point'] },
      { name: 'Arrow Left', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/arrow-left.svg', keywords: ['arrow', 'left', 'direction', 'navigate', 'back', 'previous'] },
      { name: 'Arrow Right', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/arrow-right.svg', keywords: ['arrow', 'right', 'direction', 'navigate', 'forward', 'next'] },
      { name: 'Arrow Up', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/arrow-up.svg', keywords: ['arrow', 'up', 'direction', 'navigate', 'point'] },
      { name: 'Arrows Horizontal', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/arrows-h.svg', keywords: ['arrow', 'horizontal', 'dual', 'left', 'right', 'bidirectional', 'swap'] },
      { name: 'Arrows Spin', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/arrows-spin.svg', keywords: ['arrow', 'spin', 'rotate', 'refresh', 'reload', 'cycle'] },
      { name: 'Arrows All', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/arrows.svg', keywords: ['arrow', 'all', 'directions', 'navigate', 'move', 'expand'] },
      { name: 'Calendar', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/calendar.svg', keywords: ['calendar', 'date', 'schedule', 'time', 'event', 'planner'] },
      { name: 'Discord', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/discord.svg', keywords: ['discord', 'chat', 'voice', 'gaming', 'community', 'social'] },
      { name: 'Download', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/download.svg', keywords: ['download', 'save', 'get', 'arrow', 'import'] },
      { name: 'Elgato', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/elgato.svg', keywords: ['elgato', 'stream', 'deck', 'gaming', 'streaming', 'capture'] },
      { name: 'Facebook', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/facebook.svg', keywords: ['facebook', 'social', 'media', 'meta', 'network'] },
      { name: 'Google Drive', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/google-drive.svg', keywords: ['google', 'drive', 'cloud', 'storage', 'files', 'docs'] },
      { name: 'Google', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/google.svg', keywords: ['google', 'search', 'browser', 'web', 'internet'] },
      { name: 'Instagram', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/instagram.svg', keywords: ['instagram', 'social', 'media', 'photo', 'sharing', 'meta'] },
      { name: 'Reddit', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/reddit.svg', keywords: ['reddit', 'social', 'community', 'forum', 'discussion'] },
      { name: 'Safari', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/safari.svg', keywords: ['safari', 'browser', 'web', 'apple', 'internet'] },
      { name: 'Text', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/text.svg', keywords: ['text', 'font', 'type', 'letter', 't', 'typography'] },
      { name: 'TikTok', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/tiktok.svg', keywords: ['tiktok', 'social', 'media', 'video', 'short', 'entertainment'] },
      { name: 'Twitch', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/twitch.svg', keywords: ['twitch', 'streaming', 'gaming', 'live', 'broadcast', 'stream'] },
      { name: 'X (Twitter)', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/x-twitter.svg', keywords: ['x', 'twitter', 'social', 'media', 'tweet', 'post'] },
      { name: 'YouTube', url: 'https://herovibes.github.io/HeroVibesStoreTools/StreamDeckBulkIconMaker/Images/youtube.svg', keywords: ['youtube', 'video', 'streaming', 'google', 'content', 'creator'] }
    ];

    // ===== STATE MANAGEMENT =====
    let selectedIcons = new Set();
    let filteredIcons = [...icons];

    // ===== DOM ELEMENTS =====
    const searchInput = document.getElementById('search-input');
    const iconGrid = document.getElementById('icon-grid');
    const emptyState = document.getElementById('empty-state');
    const selectionCount = document.getElementById('selection-count');
    const selectAllBtn = document.getElementById('select-all-btn');
    const clearSelectionBtn = document.getElementById('clear-selection-btn');
    const downloadBtn = document.getElementById('download-btn');
    const iconSizeInput = document.getElementById('icon-size');
    const bgColorInput = document.getElementById('bg-color');
    const iconColorInput = document.getElementById('icon-color');

    // ===== RENDER ICON GRID =====
    function renderIcons() {
      iconGrid.innerHTML = '';
      
      if (filteredIcons.length === 0) {
        iconGrid.style.display = 'none';
        emptyState.style.display = 'block';
        return;
      }

      iconGrid.style.display = 'grid';
      emptyState.style.display = 'none';

      filteredIcons.forEach((icon, index) => {
        const card = document.createElement('div');
        card.className = 'icon-card';
        if (selectedIcons.has(icon.url)) {
          card.classList.add('selected');
        }
        
        card.innerHTML = `
          <img src="${icon.url}" alt="${icon.name}" class="icon-preview">
          <div class="icon-name">${icon.name}</div>
        `;
        
        card.addEventListener('click', () => toggleIconSelection(icon.url, card));
        iconGrid.appendChild(card);
      });

      scheduleHeightCheck();
    }

    // ===== TOGGLE ICON SELECTION =====
    function toggleIconSelection(url, card) {
      if (selectedIcons.has(url)) {
        selectedIcons.delete(url);
        card.classList.remove('selected');
      } else {
        selectedIcons.add(url);
        card.classList.add('selected');
      }
      updateSelectionUI();
    }

    // ===== UPDATE SELECTION UI =====
    function updateSelectionUI() {
      selectionCount.textContent = selectedIcons.size;
      downloadBtn.disabled = selectedIcons.size === 0;
      scheduleHeightCheck();
    }

    // ===== SEARCH FUNCTIONALITY =====
    searchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase().trim();
      
      if (searchTerm === '') {
        filteredIcons = [...icons];
      } else {
        filteredIcons = icons.filter(icon => 
          icon.name.toLowerCase().includes(searchTerm) ||
          icon.keywords.some(keyword => keyword.toLowerCase().includes(searchTerm))
        );
      }
      
      renderIcons();
    });

    // ===== SELECT ALL =====
    selectAllBtn.addEventListener('click', () => {
      filteredIcons.forEach(icon => selectedIcons.add(icon.url));
      renderIcons();
      updateSelectionUI();
    });

    // ===== CLEAR SELECTION =====
    clearSelectionBtn.addEventListener('click', () => {
      selectedIcons.clear();
      renderIcons();
      updateSelectionUI();
    });

    // ===== DOWNLOAD FUNCTIONALITY =====
    downloadBtn.addEventListener('click', async () => {
      if (selectedIcons.size === 0) return;

      const size = parseInt(iconSizeInput.value);
      const bgColor = bgColorInput.value;
      const iconColor = iconColorInput.value;

      downloadBtn.disabled = true;
      downloadBtn.textContent = 'Generating...';

      try {
        for (const iconUrl of selectedIcons) {
          const icon = icons.find(i => i.url === iconUrl);
          await generateAndDownloadIcon(icon, size, bgColor, iconColor);
          await sleep(100); // Small delay between downloads
        }
        
        downloadBtn.textContent = 'Download Complete!';
        setTimeout(() => {
          downloadBtn.textContent = 'Download Selected';
          downloadBtn.disabled = false;
        }, 2000);
      } catch (error) {
        console.error('Download error:', error);
        downloadBtn.textContent = 'Error - Try Again';
        setTimeout(() => {
          downloadBtn.textContent = 'Download Selected';
          downloadBtn.disabled = false;
        }, 2000);
      }
    });

    // ===== GENERATE AND DOWNLOAD ICON =====
    async function generateAndDownloadIcon(icon, size, bgColor, iconColor) {
      try {
        // Fetch SVG content
        const response = await fetch(icon.url);
        const svgText = await response.text();
        
        // Create canvas
        const canvas = document.createElement('canvas');
        canvas.width = size;
        canvas.height = size;
        const ctx = canvas.getContext('2d');
        
        // Fill background
        ctx.fillStyle = bgColor;
        ctx.fillRect(0, 0, size, size);
        
        // Modify SVG to change color
        let modifiedSvg = svgText.replace(/fill="[^"]*"/g, `fill="${iconColor}"`);
        modifiedSvg = modifiedSvg.replace(/stroke="[^"]*"/g, `stroke="${iconColor}"`);
        
        // Add fill attribute to svg tag if not present
        if (!modifiedSvg.includes('fill=')) {
          modifiedSvg = modifiedSvg.replace('<svg', `<svg fill="${iconColor}"`);
        }
        
        // Create image from SVG
        const img = new Image();
        const svgBlob = new Blob([modifiedSvg], { type: 'image/svg+xml' });
        const url = URL.createObjectURL(svgBlob);
        
        await new Promise((resolve, reject) => {
          img.onload = resolve;
          img.onerror = reject;
          img.src = url;
        });
        
        // Calculate padding (10% on each side)
        const padding = size * 0.1;
        const iconSize = size - (padding * 2);
        
        // Draw centered icon
        ctx.drawImage(img, padding, padding, iconSize, iconSize);
        
        // Convert to PNG and download
        canvas.toBlob((blob) => {
          const downloadUrl = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = downloadUrl;
          a.download = `${icon.name.replace(/[^a-z0-9]/gi, '-').toLowerCase()}-${size}px.png`;
          a.click();
          URL.revokeObjectURL(downloadUrl);
        }, 'image/png');
        
        URL.revokeObjectURL(url);
      } catch (error) {
        console.error(`Error generating icon for ${icon.name}:`, error);
        throw error;
      }
    }

    // ===== UTILITY FUNCTION =====
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // ===== INITIALIZE =====
    renderIcons();
    updateSelectionUI();

    // ===== FOURTHWALL SCROLLBAR FIX =====
    let lastHeight = 0;
    let resizeTimer;

    function sendHeight() {
      const height = document.body.scrollHeight;
      
      if (height !== lastHeight) {
        lastHeight = height;
        window.parent.postMessage({ frameHeight: height }, '*');
      }
    }

    function scheduleHeightCheck() {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(sendHeight, 150);
    }

    window.addEventListener('load', () => {
      setTimeout(sendHeight, 100);
    });

    window.addEventListener('resize', () => {
      scheduleHeightCheck();
    });
    // ===== END OF SCROLLBAR FIX =====
  </script>
</body>
</html>
