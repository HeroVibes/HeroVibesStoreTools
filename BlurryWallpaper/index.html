<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blurry Wallpaper Generator</title>
  <style>
    :root {
      --bg: #191919;
      --card-bg: #1F1F1F;
      --hover: #323232;
      --outline: #323232;
      --accent: #87A9FF;
      --text-primary: #D4D4D4;
      --text-secondary: #8C8C8C;
      --radius: 8px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 24px 16px;
      background: var(--bg);
      font-family: sans-serif;
      color: var(--text-primary);
    }

    /* ===== MAIN CONTAINER ===== */
    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    /* ===== CONTROLS SECTION ===== */
    .controls {
      background: var(--card-bg);
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      padding: 24px 16px;
      margin-bottom: 16px;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
    }

    .control-group:last-child {
      margin-bottom: 0;
    }

    .control-label {
      font-size: 14px;
      font-weight: bold;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .toggle-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* ===== TOGGLE BUTTONS ===== */
    .toggle-btn {
      position: relative;
      padding: 10px 16px;
      border-radius: var(--radius);
      background: var(--bg);
      color: var(--text-primary);
      border: 1px solid rgba(255,255,255,0.06);
      cursor: pointer;
      overflow: hidden;
      font-size: 14px;
      font-family: sans-serif;
      transition: background 0.2s ease, border-color 0.2s ease;
      flex: 1;
      min-width: 100px;
    }

    .toggle-btn.active {
      background: var(--hover);
      border-color: var(--accent);
      color: var(--accent);
    }

    .toggle-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 75%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
      transform: skewX(-25deg);
      transition: left 0.7s ease-in-out;
    }

    .toggle-btn:hover::before {
      left: 125%;
    }

    .toggle-btn:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(135,169,255,0.12);
    }

    /* ===== ACTION BUTTONS ===== */
    .btn {
      position: relative;
      padding: 10px 16px;
      border-radius: var(--radius);
      background: var(--card-bg);
      color: var(--text-primary);
      border: 1px solid rgba(255,255,255,0.06);
      cursor: pointer;
      overflow: hidden;
      font-size: 14px;
      font-family: sans-serif;
      width: 100%;
      transition: background 0.2s ease;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 75%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
      transform: skewX(-25deg);
      transition: left 0.7s ease-in-out;
    }

    .btn:hover::before {
      left: 125%;
    }

    .btn:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(135,169,255,0.12);
    }

    .btn-primary {
      background: var(--accent);
      color: #191919;
      font-weight: bold;
    }

    .button-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    /* ===== PREVIEW SECTION ===== */
    .preview-section {
      background: var(--card-bg);
      border: 1px solid var(--outline);
      border-radius: var(--radius);
      padding: 24px 16px;
      margin-bottom: 16px;
    }

    .preview-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 12px;
      text-align: center;
    }

    .preview-container {
      width: 100%;
      aspect-ratio: 16/9;
      border-radius: var(--radius);
      overflow: hidden;
      background: var(--bg);
      border: 1px solid var(--outline);
    }

    .preview-container.vertical {
      aspect-ratio: 9/16;
      max-height: 500px;
      margin: 0 auto;
    }

    #preview-canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* ===== CHECKBOX TOGGLE ===== */
    .checkbox-toggle {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      user-select: none;
    }

    .checkbox-toggle input {
      appearance: none;
      width: 44px;
      height: 24px;
      background: var(--bg);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .checkbox-toggle input::before {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--text-secondary);
      top: 2px;
      left: 2px;
      transition: left 0.3s ease, background 0.3s ease;
    }

    .checkbox-toggle input:checked {
      background: var(--accent);
    }

    .checkbox-toggle input:checked::before {
      left: 22px;
      background: #191919;
    }

    .checkbox-toggle span {
      font-size: 14px;
      color: var(--text-primary);
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 600px) {
      body {
        padding: 16px 12px;
      }

      .button-grid {
        grid-template-columns: 1fr;
      }

      .toggle-group {
        flex-direction: column;
      }

      .toggle-btn {
        width: 100%;
      }

      .preview-container.vertical {
        max-height: 400px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ===== CONTROLS ===== -->
    <div class="controls">
      <div class="control-group">
        <div class="control-label">Orientation</div>
        <div class="toggle-group">
          <button class="toggle-btn active" data-orientation="horizontal">Horizontal (4K)</button>
          <button class="toggle-btn" data-orientation="vertical">Vertical (4K)</button>
        </div>
      </div>

      <div class="control-group">
        <label class="checkbox-toggle">
          <input type="checkbox" id="noise-toggle">
          <span>Add Noise/Grain</span>
        </label>
      </div>

      <div class="control-group">
        <div class="button-grid">
          <button class="btn" id="randomize-btn">Randomize Colors</button>
          <button class="btn btn-primary" id="download-btn">Download 4K</button>
        </div>
      </div>
    </div>

    <!-- ===== PREVIEW ===== -->
    <div class="preview-section">
      <div class="preview-label">Preview (scaled down for display)</div>
      <div class="preview-container" id="preview-container">
        <canvas id="preview-canvas"></canvas>
      </div>
    </div>
  </div>

  <script>
    // ===== WALLPAPER GENERATOR STATE =====
    let orientation = 'horizontal';
    let noiseEnabled = false;
    let currentColors = [];

    const previewCanvas = document.getElementById('preview-canvas');
    const previewCtx = previewCanvas.getContext('2d', { willReadFrequently: true });
    const previewContainer = document.getElementById('preview-container');

    // ===== ORIENTATION TOGGLES =====
    document.querySelectorAll('[data-orientation]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-orientation]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        orientation = btn.dataset.orientation;
        
        if (orientation === 'vertical') {
          previewContainer.classList.add('vertical');
        } else {
          previewContainer.classList.remove('vertical');
        }
        
        generateWallpaper();
      });
    });

    // ===== NOISE TOGGLE =====
    document.getElementById('noise-toggle').addEventListener('change', (e) => {
      noiseEnabled = e.target.checked;
      generateWallpaper();
    });

    // ===== RANDOMIZE BUTTON =====
    document.getElementById('randomize-btn').addEventListener('click', () => {
      generateWallpaper();
    });

    // ===== DOWNLOAD BUTTON =====
    document.getElementById('download-btn').addEventListener('click', () => {
      downloadWallpaper();
    });

    // ===== GENERATE RANDOM COLORS =====
    function generateRandomColors() {
      const numColors = Math.floor(Math.random() * 3) + 3; // 3-5 colors
      const colors = [];
      
      for (let i = 0; i < numColors; i++) {
        const hue = Math.random() * 360;
        const saturation = Math.random() * 40 + 40; // 40-80%
        const lightness = Math.random() * 30 + 35; // 35-65%
        colors.push(`hsl(${hue}, ${saturation}%, ${lightness}%)`);
      }
      
      return colors;
    }

    // ===== APPLY NOISE/GRAIN =====
    function applyNoise(ctx, width, height) {
      const imageData = ctx.getImageData(0, 0, width, height);
      const data = imageData.data;
      
      const noiseIntensity = 25;
      
      for (let i = 0; i < data.length; i += 4) {
        const noise = (Math.random() - 0.5) * noiseIntensity;
        data[i] += noise;     // R
        data[i + 1] += noise; // G
        data[i + 2] += noise; // B
      }
      
      ctx.putImageData(imageData, 0, 0);
    }

    // ===== GENERATE WALLPAPER =====
    function generateWallpaper() {
      currentColors = generateRandomColors();
      
      // Preview dimensions (scaled down)
      const previewWidth = previewCanvas.offsetWidth * 2 || 800;
      const previewHeight = previewCanvas.offsetHeight * 2 || 450;
      
      previewCanvas.width = previewWidth;
      previewCanvas.height = previewHeight;
      
      // Create gradient
      const gradient = previewCtx.createLinearGradient(
        0, 0,
        previewWidth, previewHeight
      );
      
      currentColors.forEach((color, index) => {
        gradient.addColorStop(index / (currentColors.length - 1), color);
      });
      
      previewCtx.fillStyle = gradient;
      previewCtx.fillRect(0, 0, previewWidth, previewHeight);
      
      // Apply blur effect using shadow blur
      previewCtx.shadowBlur = 100;
      previewCtx.shadowColor = currentColors[0];
      
      // Draw multiple overlapping circles for blur effect
      for (let i = 0; i < 20; i++) {
        const x = Math.random() * previewWidth;
        const y = Math.random() * previewHeight;
        const radius = Math.random() * 300 + 200;
        const colorIndex = Math.floor(Math.random() * currentColors.length);
        
        previewCtx.fillStyle = currentColors[colorIndex];
        previewCtx.globalAlpha = 0.3;
        previewCtx.beginPath();
        previewCtx.arc(x, y, radius, 0, Math.PI * 2);
        previewCtx.fill();
      }
      
      previewCtx.globalAlpha = 1;
      previewCtx.shadowBlur = 0;
      
      if (noiseEnabled) {
        applyNoise(previewCtx, previewWidth, previewHeight);
      }
    }

    // ===== DOWNLOAD 4K WALLPAPER =====
    function downloadWallpaper() {
      const downloadCanvas = document.createElement('canvas');
      const downloadCtx = downloadCanvas.getContext('2d', { willReadFrequently: true });
      
      // 4K dimensions
      const width = orientation === 'horizontal' ? 3840 : 2160;
      const height = orientation === 'horizontal' ? 2160 : 3840;
      
      downloadCanvas.width = width;
      downloadCanvas.height = height;
      
      // Create gradient
      const gradient = downloadCtx.createLinearGradient(0, 0, width, height);
      
      currentColors.forEach((color, index) => {
        gradient.addColorStop(index / (currentColors.length - 1), color);
      });
      
      downloadCtx.fillStyle = gradient;
      downloadCtx.fillRect(0, 0, width, height);
      
      // Apply blur effect
      downloadCtx.shadowBlur = 200;
      downloadCtx.shadowColor = currentColors[0];
      
      // Draw overlapping circles for blur
      for (let i = 0; i < 40; i++) {
        const x = Math.random() * width;
        const y = Math.random() * height;
        const radius = Math.random() * 600 + 400;
        const colorIndex = Math.floor(Math.random() * currentColors.length);
        
        downloadCtx.fillStyle = currentColors[colorIndex];
        downloadCtx.globalAlpha = 0.3;
        downloadCtx.beginPath();
        downloadCtx.arc(x, y, radius, 0, Math.PI * 2);
        downloadCtx.fill();
      }
      
      downloadCtx.globalAlpha = 1;
      downloadCtx.shadowBlur = 0;
      
      if (noiseEnabled) {
        applyNoise(downloadCtx, width, height);
      }
      
      // Download
      downloadCanvas.toBlob((blob) => {
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.download = `wallpaper-4k-${orientation}-${Date.now()}.png`;
        link.href = url;
        link.click();
        URL.revokeObjectURL(url);
      }, 'image/png');
    }

    // ===== INITIALIZE =====
    generateWallpaper();

    // ===== FOURTHWALL SCROLLBAR FIX =====
    let lastHeight = 0;
    let resizeTimer;

    function sendHeight() {
      const height = document.body.scrollHeight;
      
      if (height !== lastHeight) {
        lastHeight = height;
        window.parent.postMessage({ frameHeight: height }, '*');
      }
    }

    function scheduleHeightCheck() {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(sendHeight, 150);
    }

    window.addEventListener('load', () => {
      setTimeout(sendHeight, 100);
    });

    window.addEventListener('resize', () => {
      scheduleHeightCheck();
    });
    // ===== END OF SCROLLBAR FIX =====
  </script>
</body>
</html>
